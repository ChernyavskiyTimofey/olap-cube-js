/*!
 * Version: "0.15.1"
 * Copyright Â© 2018 Orlov Leonid. All rights reserved. Contacts: <feonitu@yandex.ru>
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cube=t():e.Cube=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,t),i.l=!0,i.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=9)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});t.InsufficientRollupData=function e(t,n){r(this,e),this.message="Can't add member, member for rollup dimension: "+t+" with id: "+n+" not found"},t.NotFoundFactId=function e(t){r(this,e),this.message="In fact data, no property was found with the name: "+t},t.NotCompletelySpaceException=function e(t){r(this,e),this.message='Not completely defined space for added member, not found member for dimension: "'+t+'"'},t.CantAddMemberRollupException=function e(t,n){r(this,e),this.message="Can't add member, rollup dimension: "+t+" with id: "+n+" not found"},t.CreateInstanceException=function e(){r(this,e),this.message="this must have prototype of Cube"},t.DimensionException=function e(t){r(this,e),this.message='For the name "'+t+'" the dimension is already set'},t.handleError=function(e){throw e.message="[Cube] "+e.message,e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),i(this,t)}return o(e,null,[{key:"create",value:function(t,n,r,i){if(this!==e&&!e.isPrototypeOf(this))throw Error("this.constructor must be prototype of Member");var o={};return o[i]=t,n.forEach(function(e){e!==i&&(o[e]=r[e])}),new this(o)}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DEFAULT_TEMPLATE_FOREIGN_KEY="%s_id",t.DEFAULT_FACT_ID_PROP="id",t.DEFAULT_MEMBER_ID_PROP="id"},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),t}(u.default);t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=n(0),a=n(5),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){var t=void 0===e?"undefined":i(e);return"object"!==t&&"function"!==t&&"undefined"!==t||null===e},s=function e(t){r(this,e);try{for(var n in t){if(!t.hasOwnProperty(n))return;c(t[n])?this[n]=t[n]:u.default.warn('[Fact] value of prop "'+n+'" has an unspecified value: '+t[n])}}catch(e){(0,o.handleError)(e)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=console,i={log:function(e){r.log("[Cube] "+e)},warn:function(e){r.warn("[Cube] "+e)},warnOnce:function(){var e={};return function(t){e[t]||(e[t]=!0,r.warn("[Cube] "+t))}}()};t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(7),l=r(s),f=n(12),h=r(f),d=n(0),m=function(e){function t(e){i(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e.dimensionTable,a=e.level,c=void 0===a?[]:a,s=e.parentNode,f=void 0===s?null:s;return Object.defineProperties(n,{dimensionTable:{value:l.default.createDimensionTable(r),editable:!1,enumerable:!0},parentNode:{value:f,enumerable:!1,editable:!1},level:{value:c.map(function(e){return new t(u({},e,{parentNode:n}))}),enumerable:!0,editable:!1}}),n.validate(),n}return a(t,e),c(t,[{key:"validate",value:function(){var e=[];this.tracePostOrder(function(t){var n=t.dimension;if(-1!==e.indexOf(n))throw new d.DimensionException;e.push(n)})}},{key:"getTreeValue",value:function(){return this.dimensionTable}},{key:"getParentTree",value:function(){return this.parentNode}},{key:"getChildTrees",value:function(){return this.level}},{key:"getDimensionTreeByDimension",value:function(e){return this.getRoot().searchTreeByTreeValue(function(t){return t.getTreeValue().dimension===e})}},{key:"createProjectionOntoMember",value:function(e){var t=this.cloneDimensionTreeWithoutMembers();return this.projectDrillDown(t,e),this.projectDrillUp(t,e),t}},{key:"projectDrillDown",value:function(e,t){var n=this,r=void 0,i=void 0;this.traceUpOrder(function(o){var a=o.getTreeValue(),u=a.dimension,c=o==n?[t]:i.drillDownDimensionMembers(r);e.getDimensionTreeByDimension(u).getTreeValue().setMemberList(c),r=c,i=o})}},{key:"projectDrillUp",value:function(e,t){var n=this,r=void 0,i=void 0;this.tracePreOrder(function(o,a){var u=a.getTreeValue(),c=u.dimension,s=a==n?[t]:i.drillUpDimensionMembers(r);e.getDimensionTreeByDimension(c).getTreeValue().setMemberList(s),r=s,i=a})}},{key:"cloneDimensionTreeWithoutMembers",value:function(){var e=new t(this.getRoot());return e.tracePostOrder(function(e,t){t.getTreeValue().clearMemberList()}),e}},{key:"removeProjectionOntoMember",value:function(e){var t=this.cloneDimensionTreeWithoutMembers();this.projectDrillDown(t,e),this.subtractDimensionTree(t);var n={},r=t.getRoot().getTreeValue(),i=r.dimension,o=r.members;return n[i]=o,n}},{key:"subtractDimensionTree",value:function(e){var t=this,n={};e.tracePostOrder(function(e){var t=e.dimension,r=e.members;n[t]=r}),1===this.getTreeValue().members.length&&this.tracePreOrder(function(e,t){var r=e.members,i=e.dimension;n[i]=r}),Object.keys(n).forEach(function(e){var r=t.getDimensionTreeByDimension(e),i=r.getTreeValue();n[e].forEach(function(e){i.removeMember(e)})})}},{key:"unionDimensionTree",value:function(e){var t=this,n={};e.tracePostOrder(function(e){var t=e.dimension,r=e.members;n[t]=r});this.getTreeValue().members;Object.keys(n).forEach(function(e){var r=t.getDimensionTreeByDimension(e),i=r.getTreeValue();n[e].forEach(function(e){i.addMember(e)})})}},{key:"drillDownDimensionMembers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isRoot())return e;var t=this.getParentTree(),n=t.getTreeValue(),r=n.members,i=n.primaryKey,o=this.getTreeValue(),a=o.foreignKey,u=[];return e.forEach(function(e){r.forEach(function(t){t[a]===e[i]&&-1===u.indexOf(t)&&u.push(t)})}),u}},{key:"drillUpDimensionMembers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isExternal())return e;var t=this.getChildTrees()[0],n=t.getTreeValue(),r=n.members,i=n.foreignKey,o=[];return e.forEach(function(e){r.forEach(function(t){e[i]===n.getMemberId(t)&&-1===o.indexOf(t)&&o.push(t)})}),o}},{key:"createMember",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getTreeValue(),n=this.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),r=[];return n.forEach(function(e){r.push(e)}),t.createMember(e,r)}}],[{key:"createDimensionTree",value:function(e){return new t(e)}},{key:"createProxyDimensionTree",value:function(e){var t=e.cloneDimensionTreeWithoutMembers();return e.tracePostOrder(function(e){var n=e.dimension,r=e.members;t.getDimensionTreeByDimension(n).getTreeValue().setMemberList(r)}),t}}]),t}(h.default);t.default=m},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),c=r(u),s=n(2),l=n(11),f=r(l),h=function(){function e(t){var n=this,r=t.dimension,a=t.foreignKey,u=void 0===a?e.genericId(r):a,l=t.primaryKey,f=void 0===l?s.DEFAULT_MEMBER_ID_PROP:l,h=t.keyProps,d=t.otherProps,m=void 0===d?[]:d,y=t.members,p=void 0===y?[]:y,v=t.defaultMemberOptions,b=void 0===v?{}:v;if(i(this,e),!r||!h)throw Error('Bad definition DimensionTable, params "dimension" and "keyProps" is required');if(-1!==Object.keys(b).indexOf(f))throw Error('Bad definition DimensionTable, "defaultMemberOptions" must not contain a "primaryKey" property');this.dimension=r,this.foreignKey=u,this.primaryKey=f,this.keyProps=[].concat(h),this.otherProps=[].concat(m),this.members=p.map(function(e){return new c.default(e,n.primaryKey)}),this.defaultMemberOptions=o({},b)}return a(e,[{key:"setMemberList",value:function(e){[].splice.apply(this.members,[0,this.members.length].concat(e))}},{key:"clearMemberList",value:function(){this.members=[]}},{key:"getMemberId",value:function(e){return e[this.primaryKey]}},{key:"addMember",value:function(e){-1===this.members.indexOf(e)?this.members.push(e):console.log("boo")}},{key:"createMember",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=o({},this.defaultMemberOptions,t),i=this.keyProps,a=this.otherProps,u=this.members,c=this.primaryKey,s=i.concat(n).concat(a),l=e.reduceId(u,c),h=f.default.create(l,s,r,c);return this.addMember(h),h}},{key:"setMemberId",value:function(e,t){e[this.primaryKey]=t}},{key:"deleteMemberId",value:function(e){delete e[this.primaryKey]}},{key:"removeMember",value:function(e){var t=this.members.indexOf(e);if(-1===t)throw new Error("represented member was not found",e);this.members.splice(t,1)}}],[{key:"reduceId",value:function(e,t){return e.length?e.reduce(function(e,n){return e[t]>n[t]?e:n},0)[t]+1:1}},{key:"genericId",value:function(e){return s.DEFAULT_TEMPLATE_FOREIGN_KEY.replace("%s",e)}},{key:"createDimensionTable",value:function(t){return new e(t)}}]),e}();t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(4),a=function(e){return e&&e.__esModule?e:{default:e}}(o),u=n(2),c=n(0),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.facts,i=void 0===n?[]:n,o=t.primaryKey,c=void 0===o?u.DEFAULT_FACT_ID_PROP:o,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.primaryKey=c,this.facts=i.map(function(e){return new a.default(e)}),this.defaultFactOptions=s,this.facts.forEach(this.validateFactData.bind(this))}return i(e,[{key:"getFacts",value:function(){return this.facts}},{key:"validateFactData",value:function(e){if(!e.hasOwnProperty(this.primaryKey))throw new c.NotFoundFactId(this.primaryKey)}}],[{key:"deleteProps",value:function(e,t,n){t.forEach(function(t){t!==n&&delete e[t]})}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t){var n={};for(var r in e)t.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e){return this.dimensionHierarchies.find(function(t){return t.getHierarchy()===e})}function f(e){var t=void 0;return this.dimensionHierarchies.forEach(function(n){n.getDimensionTreeByDimension(e)&&(t=n.getDimensionTreeByDimension(e))}),t}function h(){return this.dimensionHierarchies.map(function(e){return e.getDimensionTree?e.getDimensionTree():e})}function d(e){var t=function(e,t){var n;return(n=[]).concat.apply(n,u(e.map(function(e){return t.map(function(t){return[].concat(e,t)})})))},n=function e(n,r){for(var i=arguments.length,o=Array(i>2?i-2:0),a=2;a<i;a++)o[a-2]=arguments[a];return r?e.apply(void 0,[t(n,r)].concat(o)):n},r=[],i=e.dimensionHierarchies.map(function(e){return e.getTreeValue()}).map(function(e){return r.push(e.dimension),e.members}),o=[],a=void 0;return i.length&&(a=i.length>1?n.apply(null,i):i[0].map(function(e){return[e]}),a.forEach(function(e){var t={};return r.forEach(function(n,r){t[n]=e[r]}),o.push(new I.default(t)),t})),o}function m(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCells(),n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=x.default.denormalize(t,h.call(this));return n&&r.forEach(function(n,r){t[r]instanceof g.default&&delete n[e.cellTable.primaryKey]}),r}function y(e){var t=d(e),n=[];return t.forEach(function(t){e.dice(t).getFacts().length>1&&n.push(t)}),n}Object.defineProperty(t,"__esModule",{value:!0}),t.SubCube=void 0;var p=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},v=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}();t.cartesian=d;var b=n(10),g=r(b),O=n(1),T=(r(O),n(6)),w=r(T),E=n(13),k=r(E),_=n(7),P=r(_),D=n(8),j=r(D),M=n(0),C=n(14),x=r(C),K=n(5),V=r(K),F=n(15),I=r(F),A=n(16),R=r(A),B=n(3),L=r(B),H=n(2),U=function e(t){var n=t.cells,r=t.primaryKey,i=t.defaultFactOptions,o=void 0===i?{}:i;s(this,e),this.cells=n.map(function(e){return e instanceof L.default?e:g.default.isEmptyCell(e)?new g.default(e):new L.default(e)}),this.primaryKey=r,this.defaultFactOptions=o},S=function(){function e(t){s(this,e);var n=t.dimensionHierarchies,r=void 0===n?[]:n,i=t.cellTable,o=void 0===i?{}:i;Array.isArray(o)&&(o={cells:o},V.default.warnOnce('first argument "cells" as array type is deprecated now, use object for describe fact table'));var a=o,u=a.cells,c=void 0===u?[]:u,l=a.primaryKey,f=void 0===l?H.DEFAULT_FACT_ID_PROP:l,h=a.defaultFactOptions,d=void 0===h?{}:h;this.dimensionHierarchies=r.map(function(e){return e.hierarchy?e instanceof k.default?e:k.default.createDimensionHierarchy(e):e.dimensionTable?e instanceof w.default?e:w.default.createDimensionTree(e):e instanceof P.default?e:P.default.createDimensionTable(e)}),this.cellTable=new U({cells:c,primaryKey:f,defaultFactOptions:p({},d)})}return v(e,[{key:"slice",value:function(e,t){return this.dice(c({},e,t))}},{key:"dice",value:function(e){var t=this,n={};Object.keys(e).forEach(function(r){n[r]=Array.isArray(e[r])?e[r]:[e[r]];var i=f.call(t,r);if(!i)return void V.default.warn("Not existed dimension: "+r);var o=i.getTreeValue();n[r].forEach(function(e,i){var a=t.getDimensionMembers(r),u=a.find(function(t){return o.getMemberId(t)===o.getMemberId(e)});n[r][i]=u,e||V.default.warn("Not found member by id "+o.getMemberId(u))})});var r=this.dimensionHierarchies.length;if(Object.keys(n).length>r)throw Error("Set must have a size not more than "+r+" dimensions");var i=[],o=Object.keys(n).map(function(e){var r=void 0,o=n[e].map(function(n){var i=f.call(t,e),o=i.cloneDimensionTreeWithoutMembers();i.projectDrillDown(o,n),i.projectDrillUp(o,n),r?r.unionDimensionTree(o):r=o;var a=r.getRoot().getTreeValue();return c({},a.dimension,a.members)});return r&&i.push(r),R.default.union.apply(R.default,u(o))}),a=this.getCells(),s=function(e,n){return!Object.keys(n).some(function(r){var i=n[r],o=f.call(t,r).getTreeValue(),a=o.foreignKey,u=o.primaryKey;return!i.find(function(t){return t[u]===e[a]})})};o.forEach(function(e){a=a.filter(function(t){return s(t,e)})});var l=[];return this.dimensionHierarchies.forEach(function(e){var t=!1;if(i.forEach(function(n){e.getTreeValue().dimension===n.getTreeValue().dimension&&(l.push(n),t=!0)}),!t){var n=e.getTreeValue(),r=n.members,o=n.dimension,u=w.default.createProxyDimensionTree(e);r.forEach(function(e){var t=!1;if(a.forEach(function(n){s(n,c({},o,[e]))&&(t=!0)}),!t){-1!==u.getTreeValue().members.indexOf(e)&&u.removeProjectionOntoMember(e)}}),l.push(u)}}),new N({cellTable:a,dimensionHierarchies:l,originalCube:this.originalCube||this,previousCube:this})}},{key:"drillUp",value:function(e,t){var n=l.call(this,e);return n&&n.hasDimension(t)&&n.setActiveDimension(t),this}},{key:"drillDown",value:function(e,t){var n=l.call(this,e);return n&&n.hasDimension(t)&&n.setActiveDimension(t),this}},{key:"getFacts",value:function(){return m.call(this,this.getCells())}},{key:"addFacts",value:function(e){var t=new j.default({facts:e,primaryKey:this.cellTable.primaryKey}),n=t.getFacts().map(function(e){return new L.default(e)});[].push.apply(this.getCells(),n);var r=this.getFacts();return x.default.anotherBuild(r,n,h.call(this),this.getCells(),this.cellTable.primaryKey),this}},{key:"removeFacts",value:function(e){var t=this.getCells(),n=this.cellTable.primaryKey,r=e.map(function(e){return t.find(function(t){return t[n]===e[n]})});this.removeCells(r)}},{key:"getCells",value:function(){return this.cellTable.cells}},{key:"removeCells",value:function(e){x.default.destroy(this.getCells(),e,this.dimensionHierarchies,this)}},{key:"getDimensionMembers",value:function(e){return f.call(this,e).getTreeValue().members}},{key:"addDimensionMember",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=arguments[4];if("string"!=typeof e)throw TypeError("parameter dimension expects as string: "+e);var a={};Object.keys(n).forEach(function(e){var t=n[e],i=r.getDimensionMembers(e),o=f.call(r,e).getTreeValue(),u=o.primaryKey,c=t[u],s=i.find(function(e){return c===o.getMemberId(e)});if(!s)throw new M.InsufficientRollupData(e,c);a[e]=s});var u=f.call(this,e),s=u.getChildTrees(),l=u.getTreeValue(),h=l.foreignKey,d={};s.forEach(function(e){var t=e.getTreeValue(),r=t.dimension,i=t.foreignKey,o=t.primaryKey,a=n[r];if(!a)throw new M.InsufficientRollupData(r);d[i]=a[o]});var m=p({},t,d),y=u.createMember(m),v=h;u.traceUpOrder(function(e){if(u!==e){var t=e.getTreeValue(),n=t.dimension,r=t.foreignKey,o=c({},v,l.getMemberId(y));p(o,i[n]),y=e.createMember(o),v=r}}),this.fillEmptyCells(o)}},{key:"removeDimensionMember",value:function(e,t){var n=f.call(this,e),r=n.removeProjectionOntoMember(t),i=this.getCells(),o=function(e,t){var r=[],o=n.getDimensionTreeByDimension(e).getTreeValue(),a=o.foreignKey;return i.forEach(function(e){t.forEach(function(t){e[a]==o.getMemberId(t)&&r.push(e)})}),r};Object.keys(r).map(function(e){o(e,r[e]).forEach(function(e){var t=i.indexOf(e);-1!==t&&i.splice(t,1)})})}},{key:"addDimensionHierarchy",value:function(e){var t=w.default.createDimensionTree(e);this.dimensionHierarchies.push(t),x.default.anotherBuildOne(t,this.getCells(),this.getCells(),this.getCells(),this.cellTable.primaryKey)}},{key:"removeDimensionHierarchy",value:function(e){x.default.destroyDimensionTree(this.getCells(),this.getCells(),e,this),this.dimensionHierarchies.splice(this.dimensionHierarchies.indexOf(e),1)}},{key:"createEmptyCells",value:function(e){var t=this,n=[];return d(this).forEach(function(r){if(!t.dice(r).getCells().length){var i={};Object.keys(r).forEach(function(e){var n=f.call(t,e).getTreeValue(),o=n.foreignKey;i[o]=n.getMemberId(r[e])});var o=p({},i,e),a=g.default.createEmptyCell(o);n.push(a)}}),n}},{key:"getEmptyCells",value:function(){return this.getCells().filter(function(e){return g.default.isEmptyCell(e)})}},{key:"isEmptyCell",value:function(e){return g.default.isEmptyCell(e)}},{key:"addEmptyCells",value:function(t){e.validateInstance(t),[].push.apply(this.getCells(),t)}},{key:"fillEmptyCells",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=p({},this.cellTable.defaultFactOptions,e);if(!y(this).length){var n=this.createEmptyCells(t);this.addEmptyCells(n)}}}],[{key:"create",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];Array.isArray(t)&&(t={facts:t},V.default.warnOnce('first argument "facts" as array type is deprecated now, use object for describe fact table'));var r=t,i=r.facts,o=void 0===i?[]:i,a=r.primaryKey,u=r.defaultFactOptions,c=void 0===u?{}:u;if(!e.isPrototypeOf(this)&&e!==this)throw new M.CreateInstanceException;var s=new this({cellTable:{primaryKey:a,defaultFactOptions:c},dimensionHierarchies:n});return s.addFacts(o),s}},{key:"validateInstance",value:function(e){e.forEach(function(e){if(!(e instanceof g.default))throw new TypeError("some item in list of argument is not instances of EmptyCell")})}}]),e}(),N=t.SubCube=function(e){function t(e){var n=e.originalCube,r=e.previousCube,a=i(e,["originalCube","previousCube"]);s(this,t);var u=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,a));return u.originalCube=n,u.previousCube=r,u}return a(t,e),t}(S);t.default=S},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(3),s=function(e){return e&&e.__esModule?e:{default:e}}(c),l=function(e){function t(e,n){return r(this,t),e.id||(e.id=t.generateId()),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return o(t,e),u(t,null,[{key:"createEmptyCell",value:function(e){return new t(e)}},{key:"isEmptyCell",value:function(e){return"string"==typeof e.id}},{key:"generateId",value:function(){return a()}}]),t}(s.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var i=Object.getOwnPropertyDescriptor(t,n);if(void 0===i){var o=Object.getPrototypeOf(t);return null===o?void 0:e(o,n,r)}if("value"in i)return i.value;var a=i.get;if(void 0!==a)return a.call(r)},c=n(1),s=function(e){return e&&e.__esModule?e:{default:e}}(c),l=function(e){function t(){return r(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return o(t,e),a(t,null,[{key:"create",value:function(e,n,r,i){var o={};return n.forEach(function(e){o[e]=r.hasOwnProperty(e)?r[e]:null}),u(t.__proto__||Object.getPrototypeOf(t),"create",this).call(this,e,n,o,i)}}]),t}(s.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,[{key:"getTreeValue",value:function(){throw"abstract method"}},{key:"getParentTree",value:function(){throw"abstract method"}},{key:"getChildTrees",value:function(){throw"abstract method"}},{key:"isExternal",value:function(){return!this.getChildTrees().length}},{key:"isRoot",value:function(){return null===this.getParentTree()}},{key:"getRoot",value:function(){var e=this;return this.traceUpOrder(function(t){t.isRoot()&&(e=t)}),e}},{key:"searchTreeByTreeValue",value:function(e){var t=void 0;return this.tracePostOrder(function(n,r){e(r)&&(t=r)}),t}},{key:"traceUpOrder",value:function(e){!function t(n){var r=n.getParentTree();e(n),null!==r&&t(r)}(this)}},{key:"tracePostOrder",value:function(e){!function t(n){var r=n.getChildTrees(),i=n.getTreeValue();r.length&&r.forEach(function(e){t(e)}),e(i,n)}(this)}},{key:"tracePreOrder",value:function(e){!function t(n){var r=n.getChildTrees(),i=n.getTreeValue();e(i,n),r.length&&r.forEach(function(e){t(e)})}(this)}},{key:"hasChild",value:function(e){var t=!1;return this.tracePreOrder(function(n,r){r===e&&(t=!0)}),t}},{key:"hasParent",value:function(e){var t=!1;return this.traceUpOrder(function(n){n===e&&(t=!0)}),t}}]),e}();t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=n(6),a=function(e){return e&&e.__esModule?e:{default:e}}(o),u=function(){function e(t){var n=t.dimensionTree,i=t.activeDimension,o=t.hierarchy;if(r(this,e),!o)throw Error('attribute "hierarchy" must be defined');this.dimensionTree=n instanceof a.default?n:a.default.createDimensionTree(n),this.activeDimension=i||this.dimensionTree.getTreeValue().dimension,this.hierarchy=o}return i(e,[{key:"getDimensionTree",value:function(){return this.dimensionTree}},{key:"hasDimension",value:function(e){return!!this.dimensionTree.getDimensionTreeByDimension(e)}},{key:"getActiveDimension",value:function(){return this.activeDimension}},{key:"setActiveDimension",value:function(e){this.activeDimension=e}},{key:"getHierarchy",value:function(){return this.hierarchy}}],[{key:"createDimensionHierarchy",value:function(t){return new e(t)}}]),e}();t.default=u},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(8),s=r(c),l=n(1),f=r(l),h=function(){function e(){o(this,e)}return u(e,null,[{key:"anotherBuild",value:function(t,n,r,i,o){r.forEach(function(r){e.anotherBuildOne(r,n,i,t,o)})}},{key:"anotherBuildOne",value:function(t,n,r,i,o){t.tracePostOrder(function(t,a){e.processDimension(a,n,r,i,o)})}},{key:"processDimension",value:function(t,n,r,i,o){var a=t.getTreeValue(),u=a.dimension,c=a.keyProps,l=void 0===c?[]:c,f=a.otherProps,h=void 0===f?[]:f,d=a.members,m=a.foreignKey,y=a.primaryKey,p=t.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),v=t.getChildTrees().map(function(e){return e.getTreeValue().dimension}),b=void 0,g=d.length,O=[o,y,m,g,i,n,u,l,h,n,r];if(p.length){var T=[],w=t.getDimensionTreeByDimension(v[0]).getTreeValue(),E=w.members;T=e.mapFilter(p[0],n,E,w),b=e.makeMemberListLevel.apply(null,O.concat([p,T]))}else b=e.makeMemberList.apply(null,O);n.forEach(function(e){s.default.deleteProps(e,l,o),s.default.deleteProps(e,h,o)}),b.forEach(function(e){a.addMember(e)})}},{key:"mapFilter",value:function(e,t,n,r){var i=[];return n.forEach(function(n){var o=t.filter(function(t){return t[e]==r.getMemberId(n)});i.push(o)}),i}},{key:"makeMemberListLevel",value:function(t,n,r,i,o,a,u,c,s,l,f,h,d){var m=[],y=0;return d.forEach(function(a){if(a.length){var d=e.makeMemberList(t,n,r,i,o,a,u,c,s,l,f,y);y+=d.length;var p=a[0];h.forEach(function(e){d.forEach(function(t){t[e]=p[e],t[n]=i+m.length+1,m.push(t)}),a.forEach(function(t){delete t[e]})})}}),m}},{key:"makeMemberList",value:function(t,n,r,i,o,a,u){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],l=arguments[9],h=arguments[10],d=arguments.length>11&&void 0!==arguments[11]?arguments[11]:0,m={},y={},p=[];return h.filter(function(e){return-1===l.indexOf(e)}).forEach(function(n){var r=o.find(function(e){return e[t]===n[t]}),i=e.createKeyFromProps(c,r);i in y||(y[i]=++d)}),a.forEach(function(t){var n=e.createKeyFromProps(c,t);n in m||n in y||(m[n]=++d);var i=m[n];t[r]=i}),Object.keys(m).forEach(function(e){var t=m[e],i=a.find(function(e){return e[r]===t}),o=f.default.create(t,[].concat(c).concat(s),i,n);p.push(o)}),p}},{key:"createKeyFromProps",value:function(e,t){return e.map(function(e){return t[e]}).join(",")}},{key:"destroy",value:function(t,n,r,i){var o=this;n.forEach(function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),n.forEach(function(t){r.forEach(function(n){e.travers([t],n,[e.removeMembers.bind(o,i,n),e.restoreCell])})})}},{key:"denormalize",value:function(t,n){var r=new s.default,i=r.getFacts();return t.forEach(function(e){i.push(a({},e))}),i.forEach(function(t){n.forEach(function(n){e.travers([t],n,[e.restoreCell])})}),i}},{key:"restoreCell",value:function(e,t,n,r,i,o){var u=new f.default(e);o.deleteMemberId(u),delete r[i],a(r,u)}},{key:"removeMembers",value:function(e,t,n,r,o,a,u){var c=e.dice(i({},o,n)),s=t.getDimensionTreeByDimension(o).getTreeValue();c.getCells().length||s.removeMember(n)}},{key:"travers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=function(e,t){var r=e.getTreeValue(),i=r.dimension,o=r.members,a=r.foreignKey,u=t[a],c=o.find(function(e){return r.getMemberId(e)===u});n.forEach(function(e){e(c,o,i,t,a,r)})};e.forEach(function(e){t.tracePreOrder(function(t,n){r(n,e)})})}},{key:"destroyDimensionTree",value:function(t,n,r,i){e.travers(t,r,[e.removeMembers.bind(this,i,r),e.restoreCell])}}]),e}();t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},o=function e(t){r(this,e),i(this,t)};t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),o=function(){function e(){r(this,e)}return i(e,null,[{key:"union",value:function(){var t={};return[].concat(Array.prototype.slice.call(arguments)).forEach(function(n){e.add(t,n)}),t}},{key:"add",value:function(e,t){Object.keys(t).forEach(function(n){e[n]||(e[n]=[]),Array.prototype.push.apply(e[n],t[n])})}}]),e}();t.default=o}]).default});