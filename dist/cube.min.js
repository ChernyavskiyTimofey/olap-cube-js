/*!
 * Version: "0.7.0"
 * Copyright Â© 2018 Orlov Leonid. All rights reserved. Contacts: <feonitu@yandex.ru>
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cube=t():e.Cube=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var r={};return t.m=e,t.c=r,t.d=function(e,r,n){t.o(e,r)||Object.defineProperty(e,r,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(r,"a",r),r},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=1)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ENTITY_ID="id",t.DEFUALT_TEMPLATE_FOREIGN_KEY="%s_id"},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function i(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(5),l=n(f),s=r(0),p=r(2),y=(n(p),r(10)),b=n(y),h=r(9),d=n(h),v=r(4),m=r(14),O=n(m),g=r(7),_=(n(g),r(15)),T=n(_),j=r(16),w=n(j),P=r(18),E=n(P),k=r(3),D=n(k),M=function(){function e(t){var r=this;u(this,e);var n=t.dimensionHierarchies,o=t.cellTable,i=void 0===o?[]:o,c=t.settings,f=void 0===c?{}:c;this.settings=a({},f),this.dimensionHierarchies=n.map(function(e){return b.default.createDimensionTree(e,r.settings)}),this.cellTable=new T.default(i)}return c(e,[{key:"addFacts",value:function(e){var t=new d.default(e),r=t.map(function(e){return new D.default(e)});this.cellTable.addCells(r);var n=this.denormalize(this.getMeasure());O.default.anotherBuild(n,r,this.dimensionHierarchies,this.cellTable)}},{key:"removeFacts",value:function(e){var t=this.cellTable,r=e.map(function(e){return t.find(function(t){return t[s.ENTITY_ID]===e[s.ENTITY_ID]})});O.default.destroy(t,r,this.dimensionHierarchies,this)}},{key:"getFacts",value:function(){return this.denormalize(this.getMeasure())}},{key:"getDimensionMembers",value:function(e){return this.findDimensionTreeByDimension(e).getTreeValue().members}},{key:"getFactsBySet",value:function(e){return this.denormalize(this.getMeasureBySet(e))}},{key:"getMeasure",value:function(){return this.cellTable}},{key:"getMeasureBySet",value:function(e){return this.projection(e).cellTable}},{key:"getDimensionMembersBySet",value:function(e,t){var r=this.projection(t),n=r.cellTable;return this.getDimensionMembersFromCells(e,n)}},{key:"projection",value:function(e){var t=this;if(e){var r=this.getMeasure();if(0===Object.keys(e).length)return{cellTable:r};var n={};Object.keys(e).forEach(function(t){n[t]=Array.isArray(e[t])?e[t]:[e[t]]});var u=Object.keys(n).map(function(e){var r=n[e].map(function(r){var n=t.findDimensionTreeByDimension(e),o=n.createProjectionOntoMember(e,r),u=o.getRoot().getTreeValue();return i({},u.dimension,u.members)});return E.default.union.apply(E.default,o(r))}),a=r,c=function(e,r){return!Object.keys(r).some(function(n){var o=r[n],i=t.findDimensionTreeByDimension(n).getTreeValue(),u=i.idAttribute;return!o.find(function(t){return t[s.ENTITY_ID]===e[u]})})};return u.forEach(function(e){a=a.filter(function(t){return c(t,e)})}),{cellTable:a}}}},{key:"findDimensionTreeByDimension",value:function(e){var t=void 0;return this.dimensionHierarchies.forEach(function(r){r.getDimensionTreeByDimension(e)&&(t=r.getDimensionTreeByDimension(e))}),t}},{key:"getDimensionMembersFromCells",value:function(e,t){var r=this.findDimensionTreeByDimension(e),n=r.getRoot().getTreeValue(),o=n.members,i=n.dimension,u=n.idAttribute,a=[];if(t.forEach(function(e){o.forEach(function(t){e[u]===t[s.ENTITY_ID]&&-1===a.indexOf(t)&&a.push(t)})}),r.isRoot())return a;var c=a,f=!1,l=i;return r.getRoot().tracePreOrder(function(t,n){n.isRoot()||(f||(c=r.rollUpDimensionMembers(l,c),l=t.dimension),t.dimension===e&&(f=!0))}),c}},{key:"cartesian",value:function(){var e=function(e,t){var r;return(r=[]).concat.apply(r,o(e.map(function(e){return t.map(function(t){return[].concat(e,t)})})))},t=function t(r,n){for(var o=arguments.length,i=Array(o>2?o-2:0),u=2;u<o;u++)i[u-2]=arguments[u];return n?t.apply(void 0,[e(r,n)].concat(i)):r},r=[],n=this.dimensionHierarchies.map(function(e){return e.getTreeValue()}).map(function(e){return r.push(e.dimension),e.members}),i=t.apply(null,n),u=new w.default;return i.forEach(function(e){var t={};return r.forEach(function(r,n){t[r]=e[n]}),u.addTuple(t),t}),u}},{key:"denormalize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getMeasure(),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=O.default.denormalize(e,this.dimensionHierarchies);return t&&r.forEach(function(t,r){e[r]instanceof l.default&&delete t[s.ENTITY_ID]}),r}},{key:"residuals",value:function(){var e=this,t=this.cartesian(),r=[];return t.forEach(function(t){e.getFactsBySet(t).length>1&&r.push(t)}),r}},{key:"addDimensionMember",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},u=arguments[4];if("string"!=typeof e)throw TypeError("parameter dimension expects as string: "+e);var c={};Object.keys(r).forEach(function(e){var t=r[e],o=n.getDimensionMembers(e),i=t[s.ENTITY_ID],u=o.find(function(e){return i===e[s.ENTITY_ID]});if(!u)throw new v.CantAddMemberRollupException(e,i);c[e]=u});var f=this.findDimensionTreeByDimension(e);f.getChildTrees().forEach(function(e){var n=e.getTreeValue(),o=n.dimension,i=n.idAttribute,u=r[o];if(!u)throw new v.CantAddMemberRollupException(o);t[i]=u[s.ENTITY_ID]});var l=f.getTreeValue(),p=l.idAttribute,y=f.createMember(t),b=p;f.traceUpOrder(function(e){if(f!==e){var t=e.getTreeValue(),r=t.dimension,n=t.idAttribute,u=i({},b,y[s.ENTITY_ID]);a(u,o[r]),y=e.createMember(u),b=n}}),this.fill(u)}},{key:"removeDimensionMember",value:function(e,t){var r=this.findDimensionTreeByDimension(e),n=r.removeDimensionMember(e,t),o=this.getMeasure(),i=function(e,t){var n=[],i=r.getDimensionTreeByDimension(e).getTreeValue().idAttribute;return o.forEach(function(e){t.forEach(function(t){e[i]==t[s.ENTITY_ID]&&n.push(e)})}),n};Object.keys(n).map(function(e){i(e,n[e]).forEach(function(e){o.removeCell(e)})})}},{key:"fill",value:function(e){var t=this;if(!this.residuals().length){this.cartesian().forEach(function(r){if(!t.getMeasureBySet(r).length){var n={};Object.keys(r).forEach(function(e){var o=t.findDimensionTreeByDimension(e).getTreeValue(),i=o.idAttribute;n[i]=r[e][s.ENTITY_ID]}),n=a({},n,e),t.cellTable.createCell(n)}})}}},{key:"unfilled",value:function(){var e=this,t=this.cartesian(),r=[];return t.forEach(function(t){0===e.getFactsBySet(t).length&&r.push(t)}),r}}],[{key:"create",value:function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.isPrototypeOf(this)&&e!==this)throw new v.CreateInstanceException;var o=new this({dimensionHierarchies:r,settings:n});return o.addFacts(t),o}}]),e}();t.default=M},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=r(0),a=function(){function e(t){n(this,e),o(this,t)}return i(e,null,[{key:"create",value:function(t,r,n){if(this!==e&&!e.isPrototypeOf(this))throw Error("this.constructor must be prototype of Member");var o={};return o[u.ENTITY_ID]=t,r.forEach(function(e){e!==u.ENTITY_ID&&(o[e]=n[e])}),new this(o)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=r(0),c=r(6),f=function(e){return e&&e.__esModule?e:{default:e}}(c),l=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"deleteProps",value:function(e){var t=this;e.forEach(function(e){e!==a.ENTITY_ID&&delete t[e]})}}]),t}(f.default);t.default=l},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.NotCompletelySpaceException=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.message='Not completely defined space for added member, not found member for dimension: "'+e+'"',r}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.CantAddMemberRollupException=function(e){function t(e,r){n(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.message="Can't add member, rollup dimension: "+e+" with id: "+r+" not found",i}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.NotFoundFactId=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.message="Not found fact id",e}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.CreateInstanceException=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.message="this must have prototype of Cube",e}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.DimensionException=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.message='For the name "'+e+'" the dimension is already set',r}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.handleError=function(e){throw e instanceof Error&&(e.message="[Cube] "+e.message),e}},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}Object.defineProperty(t,"__esModule",{value:!0});var a=r(3),c=function(e){return e&&e.__esModule?e:{default:e}}(a),f=function(e){function t(e,r){return n(this,t),e.id||(e.id=u()),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r))}return i(t,e),t}(c.default);t.default=f},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=r(0),u=r(4),a=r(7),c=function(e){return e&&e.__esModule?e:{default:e}}(a),f=function(e){var t=void 0===e?"undefined":o(e);return"object"!==t&&"function"!==t&&"undefined"!==t||null===e},l=function e(t){n(this,e);try{for(var r in t){if(!t.hasOwnProperty(r))return;f(t[r])?this[r]=t[r]:c.default.warn('[Fact] value of prop "'+r+'" has an unspecified value: '+t[r])}if(!(i.ENTITY_ID in this))throw new u.NotFoundFactId}catch(e){(0,u.handleError)(e)}};t.default=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=console,o={log:function(e){n.log("[Cube] "+e)},warn:function(e){n.warn("[Cube] "+e)},warnOnce:function(){var e={};return function(t){e[t]||(e[t]=!0,n.warn("[Cube] "+t))}}()};t.default=o},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(0),l=r(2),s=n(l),p=r(12),y=n(p),b=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&(e=e.map(function(e){return new s.default(e)}),a(r,e)),r}return u(t,e),c(t,[{key:"filter",value:function(){return[].filter.apply(this,arguments)}},{key:"addMember",value:function(e){this.indexOf(-1===e[f.ENTITY_ID])&&this.push(e)}},{key:"removeMember",value:function(e){var t=this.indexOf(e);if(-1===t)throw new Error("represented member was not found",e);this.splice(t,1)}},{key:"setMembers",value:function(e){this.splice(0,this.length),a(this,e)}},{key:"createMember",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.reduceId(),o=void 0;switch(r){case"input":o=y.default;break;default:o=s.default}var i=o.create(n,e,t);return this.addMember(i),i}},{key:"reduceId",value:function(){return this.length?this.reduce(function(e,t){return e[f.ENTITY_ID]>t[f.ENTITY_ID]?e:t},0).id+1:1}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=b},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=r(6),c=function(e){return e&&e.__esModule?e:{default:e}}(a),f=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&u(r,e.map(function(e){return new c.default(e)})),r}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=f},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(11),l=n(f),s=r(13),p=n(s),y=(r(4),r(1)),b=(n(y),r(0)),h=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),n=e.dimensionTable,u=e.dependency,c=void 0===u?[]:u,f=e.parentNode,s=void 0===f?null:f;return Object.defineProperties(r,{dimensionTable:{value:new l.default(n),editable:!1,enumerable:!0},parentNode:{value:s,enumerable:!1,editable:!1},dependency:{value:c.map(function(e){return new t(a({},e,{parentNode:r}))}),enumerable:!0,editable:!1}}),r}return u(t,e),c(t,[{key:"getTreeValue",value:function(){return this.dimensionTable}},{key:"getParentTree",value:function(){return this.parentNode}},{key:"getChildTrees",value:function(){return this.dependency}},{key:"getDimensionTreeByDimension",value:function(e){return this.getRoot().searchTreeByTreeValue(function(t){return t.getTreeValue().dimension===e})}},{key:"createProjectionOntoMember",value:function(e,r){var n=this,o=new t(this.getRoot());o.tracePostOrder(function(e,t){t.getTreeValue().clearMemberList()});var i=this.getDimensionTreeByDimension(e),u=void 0,a=void 0;return i.traceUpOrder(function(e){var t=e.getTreeValue(),c=t.dimension,f=e==i?[r]:n.drillDownDimensionMembers(a,u);o.getDimensionTreeByDimension(c).getTreeValue().setMemberList(f),a=c,u=f}),o}},{key:"removeDimensionMember",value:function(e,t){var r=this,n=this.getDimensionTreeByDimension(e),o=n.createProjectionOntoMember(e,t),i={},u={};o.tracePostOrder(function(e){var t=e.dimension,r=e.members;i[t]=r}),1===n.getTreeValue().members.length&&n.tracePreOrder(function(e){var t=e.getTreeValue(),r=t.members,n=t.dimension;i[n]=r}),Object.keys(i).forEach(function(e){var t=r.getDimensionTreeByDimension(e),n=t.getTreeValue().members;i[e].forEach(function(e){n.removeMember(e)})});var a=o.getRoot().getTreeValue(),c=a.dimension,f=a.members;return u[c]=f,u}},{key:"drillDownDimensionMembers",value:function(e,t){var r=this.getRoot().getDimensionTreeByDimension(e);if(r.isRoot())return t;var n=r.getParentTree(),o=n.getTreeValue(),i=o.members,u=r.getTreeValue(),a=u.idAttribute,c=[];return t.forEach(function(e){i.forEach(function(t){t[a]===e[b.ENTITY_ID]&&-1===c.indexOf(t)&&c.push(t)})}),c}},{key:"rollUpDimensionMembers",value:function(e,t){var r=this.getRoot().getDimensionTreeByDimension(e);if(r.isExternal())return t;var n=r.getChildTrees()[0],o=n.getTreeValue(),i=o.members,u=o.idAttribute,a=[];return t.forEach(function(e){i.forEach(function(t){e[u]===t[b.ENTITY_ID]&&-1===a.indexOf(t)&&a.push(t)})}),a}},{key:"createMember",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getTreeValue(),r=this.getChildTrees().map(function(e){return e.getTreeValue().idAttribute}),n=[];return r.forEach(function(e){n.push(e)}),t.createMember(e,n)}}],[{key:"createDimensionTree",value:function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=r.templateForeignKey,o=void 0===n?b.DEFUALT_TEMPLATE_FOREIGN_KEY:n,i=function(e){e.idAttribute||(e.idAttribute=t.genericId(e.dimension,o))},u=new t(e);return u.tracePostOrder(i),u}},{key:"genericId",value:function(e,t){return t.replace("%s",e)}}]),t}(p.default);t.default=h},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=r(8),u=function(e){return e&&e.__esModule?e:{default:e}}(i),a=function(){function e(t){var r=t.dimension,o=t.idAttribute,i=t.keyProps,a=t.otherProps,c=void 0===a?[]:a,f=t.members,l=void 0===f?[]:f;if(n(this,e),!r||!i)throw Error("Bad definition DimensionTable, params 'dimension' and 'keyProps' is required");this.dimension=r,this.idAttribute=o,this.keyProps=i.map(function(e){return e}),this.otherProps=c.map(function(e){return e}),this.members=new u.default(l)}return o(e,[{key:"setMemberList",value:function(e){this.members.setMembers(e)}},{key:"clearMemberList",value:function(){this.members=new u.default([])}},{key:"createMember",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],r=this.keyProps;return this.members.createMember(r.concat(t),e)}}]),e}();t.default=a},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},c=r(2),f=function(e){return e&&e.__esModule?e:{default:e}}(c),l=function(e){function t(){return n(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,null,[{key:"create",value:function(e,r,n){var o={};return r.forEach(function(e){o[e]=n.hasOwnProperty(e)?n[e]:null}),a(t.__proto__||Object.getPrototypeOf(t),"create",this).call(this,e,r,o)}}]),t}(f.default);t.default=l},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){n(this,e)}return o(e,[{key:"getTreeValue",value:function(){throw"abstract method"}},{key:"getParentTree",value:function(){throw"abstract method"}},{key:"getChildTrees",value:function(){throw"abstract method"}},{key:"isExternal",value:function(){return!this.getChildTrees().length}},{key:"isFirstLevel",value:function(){return!this.isRoot()&&null===this.getParentTree().getParentTree()}},{key:"isRoot",value:function(){return null===this.getParentTree()}},{key:"getRoot",value:function(){var e=this;return this.traceUpOrder(function(t){t.isRoot()&&(e=t)}),e}},{key:"searchTreeByTreeValue",value:function(e){var t=void 0;return this.tracePostOrder(function(r,n){e(n)&&(t=n)}),t}},{key:"traceUpOrder",value:function(e){!function t(r){var n=r.getParentTree();e(r),null!==n&&t(n)}(this)}},{key:"tracePostOrder",value:function(e){!function t(r){var n=r.getChildTrees(),o=r.getTreeValue();n.length&&n.forEach(function(e){t(e)}),e(o,r)}(this)}},{key:"tracePreOrder",value:function(e){!function t(r){var n=r.getChildTrees(),o=r.getTreeValue();e(o,r),n.length&&n.forEach(function(e){t(e)})}(this)}}]),e}();t.default=i},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=r(8),f=(n(c),r(2)),l=n(f),s=r(0),p=r(1),y=(n(p),r(9)),b=n(y),h=function(){function e(){i(this,e)}return a(e,null,[{key:"anotherBuild",value:function(t,r,n,o){n.forEach(function(n){n.tracePostOrder(function(n,i){e.processDimension(i,r,o,t)})})}},{key:"processDimension",value:function(t,r,n,o){var i=t.isFirstLevel(),u=t.getTreeValue(),a=u.dimension,c=u.keyProps,f=void 0===c?[]:c,l=u.otherProps,s=void 0===l?[]:l,p=u.members,y=u.idAttribute,b=t.getChildTrees().map(function(e){return e.getTreeValue().idAttribute}),h=t.getChildTrees().map(function(e){return e.getTreeValue().dimension}),d=void 0,v=p.length,m=[y,v,o,r,a,f,s,r,i,n];if(b.length){var O=[],g=t.getDimensionTreeByDimension(h[0]).getTreeValue().members;O=e.mapFilter(b[0],r,g),d=e.makeMemberListDependency.apply(null,m.concat([b,O]))}else d=e.makeMemberList.apply(null,m);var _=[].concat(f,s);r.forEach(function(e){e.deleteProps(_)}),d.forEach(function(e){p.addMember(e)})}},{key:"mapFilter",value:function(e,t,r){var n=[];return r.forEach(function(r){var o=t.filter(function(t){return t[e]==r[s.ENTITY_ID]});n.push(o)}),n}},{key:"makeMemberListDependency",value:function(t,r,n,o,i,u,a,c,f,l,p,y){var b=[],h=0;return y.forEach(function(o){if(o.length){var y=e.makeMemberList(t,r,n,o,i,u,a,c,f,l,h);h+=y.length;var d=o[0];p.forEach(function(e){y.forEach(function(t){t[e]=d[e],t[s.ENTITY_ID]=r+b.length+1,b.push(t)}),o.forEach(function(t){delete t[e]})})}}),b}},{key:"makeMemberList",value:function(t,r,n,o,i){var u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[],c=arguments[7],f=(arguments[8],arguments[9]),p=arguments.length>10&&void 0!==arguments[10]?arguments[10]:0,y={},b={},h=[],d=[].concat(u,a);return f.filter(function(e){return-1===c.indexOf(e)}).forEach(function(t){var r=n.find(function(e){return e[s.ENTITY_ID]===t[s.ENTITY_ID]}),o=e.createKeyFromProps(u,r);o in b||(b[o]=++p)}),o.forEach(function(r){var n=e.createKeyFromProps(u,r);n in y||n in b||(y[n]=++p);var o=y[n];r[t]=o}),Object.keys(y).forEach(function(e){var r=y[e],n=o.find(function(e){return e[t]===r}),i=l.default.create(r,d,n);h.push(i)}),h}},{key:"createKeyFromProps",value:function(e,t){return e.map(function(e){return t[e]}).join(",")}},{key:"destroy",value:function(e,t,r,n){t.forEach(function(t){e.removeCell(t)});var i=function(e,t,r){n.projection(o({},r,e)).cellTable.length||t.removeMember(e)};this.denormalize(t,r,i)}},{key:"denormalize",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=new b.default;e.forEach(function(e){n.push(u({},e))});var o=function(e,t){var n=e.getTreeValue(),o=n.dimension,i=n.members,a=n.idAttribute,c=t[a],f=i.find(function(e){return e[s.ENTITY_ID]===c});r(f,i,o);var l=u({},f);delete l[s.ENTITY_ID],delete t[a],u(t,l)};return n.forEach(function(e){t.forEach(function(t){t.tracePreOrder(function(t,r){o(r,e)})})}),n}}]),e}();t.default=h},function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),f=r(3),l=n(f),s=r(0),p=r(1),y=(n(p),r(5)),b=n(y),h=function(e){function t(e){o(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&a(r,e.map(function(e){return new l.default(e)})),r}return u(t,e),c(t,[{key:"findById",value:function(e){return this.find(function(t){return t[s.ENTITY_ID]===e})}},{key:"addCell",value:function(e){this.push(e)}},{key:"addCells",value:function(e){var t=this;e.forEach(function(e){t.addCell(e)})}},{key:"removeCell",value:function(e){var t=this.indexOf(e);this.splice(t,1)}},{key:"createCell",value:function(e){var t=new b.default(e);this.addCell(t)}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=h},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=function e(t,r,n){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,r);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,r,n)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(n)},f=r(17),l=function(e){return e&&e.__esModule?e:{default:e}}(f),s=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&u(r,e.map(function(e){return new l.default(e)})),r}return i(t,e),a(t,[{key:"addTuple",value:function(e){this.push(new l.default(e))}},{key:"forEach",value:function(){return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"forEach",this).apply(this,arguments)}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=s},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},i=function e(t){n(this,e),o(this,t)};t.default=i},function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=function(){function e(){n(this,e)}return o(e,null,[{key:"union",value:function(){var t={};return[].concat(Array.prototype.slice.call(arguments)).forEach(function(r){e.add(t,r)}),t}},{key:"add",value:function(e,t){Object.keys(t).forEach(function(r){e[r]||(e[r]=[]),Array.prototype.push.apply(e[r],t[r])})}}]),e}();t.default=i}]).default});