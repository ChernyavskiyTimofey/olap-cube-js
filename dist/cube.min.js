!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Cube=t()}(this,function(){"use strict";function o(e){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function t(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter(function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),r.forEach(function(e){y(t,e,n[e])})}return t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&n(e,t)}function s(e){return(s=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function n(e,t){return(n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function a(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],0<=t.indexOf(n)||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function l(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?c(e):t}function u(e,t,n){return(u="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=s(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function m(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var e,p=function e(t,n){v(this,e),this.message="Can't add member, member for rollup dimension: ".concat(t," with id: ").concat(n," not found")},f=function e(t){v(this,e),this.message="In fact data, no property was found with the name: ".concat(t)},h=function e(t){v(this,e),this.message='For the name "'.concat(t,'" the dimension is already set')},b=console,g=function(e){b.warn("[Cube] ".concat(e))},T=(e={},function e(t){v(this,e);try{for(var n in t){if(!t.hasOwnProperty(n))return;r=t[n],void 0,"object"!==(i=o(r))&&"function"!==i&&"undefined"!==i||null===r?this[n]=t[n]:g('[Fact] value of prop "'.concat(n,'" has an unspecified value: ').concat(t[n]))}}catch(e){!function(e){throw e.message="[Cube] ".concat(e.message),e}(e)}var r,i}),O=function(e){function t(){return v(this,t),l(this,s(t).apply(this,arguments))}return i(t,T),t}();var k=function(e){function n(e,t){return v(this,n),e.id||(e.id=n.generateId()),l(this,s(n).call(this,e,t))}return i(n,O),t(n,null,[{key:"createEmptyCell",value:function(e){return new n(e)}},{key:"isEmptyCell",value:function(e){return"string"==typeof e.id}},{key:"generateId",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}}]),n}(),D=function(){function o(e){v(this,o),Object.assign(this,e)}return t(o,null,[{key:"create",value:function(e,t,n,r){if(this!==o&&!o.isPrototypeOf(this))throw Error("this.constructor must be prototype of Member");var i={};return i[r]=e,t.forEach(function(e){e!==r&&(i[e]=n[e])}),new this(i)}}]),o}(),E=function(e){function o(){return v(this,o),l(this,s(o).apply(this,arguments))}return i(o,D),t(o,null,[{key:"create",value:function(e,t,n,r){var i={};return t.forEach(function(e){i[e]=n.hasOwnProperty(e)?n[e]:null}),u(s(o),"create",this).call(this,e,t,i,r)}}]),o}(),w=function(){function y(e){var t=this,n=e.dimension,r=e.foreignKey,i=void 0===r?y.genericId(n):r,o=e.primaryKey,a=void 0===o?"id":o,u=e.keyProps,s=e.otherProps,c=void 0===s?[]:s,l=e.members,f=void 0===l?[]:l,h=e.defaultMemberOptions,m=void 0===h?{}:h;if(v(this,y),!n||!u)throw Error('Bad definition DimensionTable, params "dimension" and "keyProps" is required');if(-1!==Object.keys(m).indexOf(a))throw Error('Bad definition DimensionTable, "defaultMemberOptions" must not contain a "primaryKey" property');this.dimension=n,this.foreignKey=i,this.primaryKey=a,this.keyProps=[].concat(u),this.otherProps=[].concat(c),this.members=f.map(function(e){return new D(e,t.primaryKey)}),this.defaultMemberOptions=d({},m)}return t(y,[{key:"setMemberList",value:function(e){[].splice.apply(this.members,[0,this.members.length].concat(e))}},{key:"clearMemberList",value:function(){this.members=[]}},{key:"getMemberPrimaryKey",value:function(e){return e[this.primaryKey]}},{key:"getMemberForeignKey",value:function(e){return e[this.foreignKey]}},{key:"addMember",value:function(e){-1===this.members.indexOf(e)?this.members.push(e):console.log("boo")}},{key:"createMember",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length?arguments[1]:void 0,n=d({},this.defaultMemberOptions,e),r=this.keyProps,i=this.otherProps,o=this.members,a=this.primaryKey,u=r.concat(t).concat(i),s=y.reduceId(o,a),c=E.create(s,u,n,a);return this.addMember(c),c}},{key:"setMemberId",value:function(e,t){e[this.primaryKey]=t}},{key:"deleteMemberId",value:function(e){delete e[this.primaryKey]}},{key:"removeMember",value:function(e){var t=this.members.indexOf(e);if(-1===t)throw new Error("represented member was not found",e);this.members.splice(t,1)}}],[{key:"reduceId",value:function(e,n){return e.length?e.reduce(function(e,t){return e[n]>t[n]?e:t},0)[n]+1:1}},{key:"genericId",value:function(e){return"%s_id".replace("%s",e)}},{key:"createDimensionTable",value:function(e){return new y(e)}}]),y}(),j=function(){function e(){v(this,e)}return t(e,[{key:"getTreeValue",value:function(){throw"abstract method"}},{key:"getParentTree",value:function(){throw"abstract method"}},{key:"getChildTrees",value:function(){throw"abstract method"}},{key:"isExternal",value:function(){return!this.getChildTrees().length}},{key:"isRoot",value:function(){return null===this.getParentTree()}},{key:"getRoot",value:function(){var n=this;return this.traceUpOrder(function(e,t){t.isRoot()&&(n=t)}),n}},{key:"traceUpOrder",value:function(e){var t=this.getParentTree();e(this.getTreeValue(),this),null!==t&&t.traceUpOrder(e)}},{key:"tracePostOrder",value:function(t){var e=this.getChildTrees(),n=this.getTreeValue();e.length&&e.forEach(function(e){e.tracePostOrder(t)}),t(n,this)}},{key:"tracePreOrder",value:function(t){var e=this.getChildTrees(),n=this.getTreeValue();t(n,this),e.length&&e.forEach(function(e){e.tracePreOrder(t)})}}]),e}(),P=function(e){function u(e){var t;v(this,u),t=l(this,s(u).call(this));var n=e.dimensionTable,r=e.level,i=void 0===r?[]:r,o=e.parentNode,a=void 0===o?null:o;return Object.defineProperties(c(c(t)),{dimensionTable:{value:w.createDimensionTable(n),editable:!1,enumerable:!0},parentNode:{value:a,enumerable:!1,editable:!1},level:{value:i.map(function(e){return new u(d({},e,{parentNode:c(c(t))}))}),enumerable:!0,editable:!1}}),t.validateDimensions(),t}return i(u,j),t(u,[{key:"validateDimensions",value:function(){var n=[];this.tracePostOrder(function(e){var t=e.dimension;if(-1!==n.indexOf(t))throw new h;n.push(t)})}},{key:"getTreeValue",value:function(){return this.dimensionTable}},{key:"getParentTree",value:function(){return this.parentNode}},{key:"getChildTrees",value:function(){return this.level}},{key:"getDimensionTreeByDimension",value:function(n){var e=this.getRoot(),r=void 0;return e.tracePostOrder(function(e,t){e.dimension===n&&(r=t)}),r}},{key:"createProjectionOntoMember",value:function(e){var t=this.cloneDimensionTreeWithoutMembers();return this.projectDrillDown(t,e),this.projectDrillUp(t,e),t}},{key:"projectDrillDown",value:function(e,t){this.projectDrill(e,t,"traceUpOrder","drillDownDimensionMembers")}},{key:"projectDrillUp",value:function(e,t){this.projectDrill(e,t,"tracePreOrder","drillUpDimensionMembers")}},{key:"projectDrill",value:function(i,o,e,a){var u,s,c=this;this[e](function(e,t){var n=e.dimension,r=t==c?[o]:s[a](u);i.getDimensionTreeByDimension(n).getTreeValue().setMemberList(r),u=r,s=t})}},{key:"cloneDimensionTreeWithoutMembers",value:function(){var e=new u(this.getRoot());return e.tracePostOrder(function(e){e.clearMemberList()}),e}},{key:"removeProjectionOntoMember",value:function(e){var t=this.cloneDimensionTreeWithoutMembers();this.projectDrillDown(t,e),this.subtractDimensionTree(t);var n={},r=t.getRoot().getTreeValue(),i=r.dimension,o=r.members;return n[i]=o,n}},{key:"subtractDimensionTree",value:function(e){var n=this,i={};e.tracePostOrder(function(e){var t=e.dimension,n=e.members;i[t]=n}),1===this.getTreeValue().members.length&&this.tracePreOrder(function(e,t){var n=e.members,r=e.dimension;i[r]=n}),Object.keys(i).forEach(function(e){var t=n.getDimensionTreeByDimension(e).getTreeValue();i[e].forEach(function(e){t.removeMember(e)})})}},{key:"unionDimensionTree",value:function(e){var n=this,r={};e.tracePostOrder(function(e){var t=e.dimension,n=e.members;r[t]=n}),Object.keys(r).forEach(function(e){var t=n.getDimensionTreeByDimension(e).getTreeValue();r[e].forEach(function(e){t.addMember(e)})})}},{key:"drillDownDimensionMembers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isRoot())return e;var n=this.getParentTree().getTreeValue(),r=this.getTreeValue(),i=n.members,o=[];return e.forEach(function(t){i.forEach(function(e){r.getMemberForeignKey(e)===n.getMemberPrimaryKey(t)&&-1===o.indexOf(e)&&o.push(e)})}),o}},{key:"drillUpDimensionMembers",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isExternal())return e;var n=this.getChildTrees()[0].getTreeValue(),r=n.members,i=[];return e.forEach(function(t){r.forEach(function(e){n.getMemberForeignKey(t)===n.getMemberPrimaryKey(e)&&-1===i.indexOf(e)&&i.push(e)})}),i}},{key:"createMember",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.getTreeValue(),n=this.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),r=[];return n.forEach(function(e){r.push(e)}),t.createMember(e,r)}}],[{key:"createDimensionTree",value:function(e){return new u(e)}},{key:"createProxyDimensionTree",value:function(e){var r=e.cloneDimensionTreeWithoutMembers();return e.tracePostOrder(function(e){var t=e.dimension,n=e.members;r.getDimensionTreeByDimension(t).getTreeValue().setMemberList(n)}),r}}]),u}(),C=function(){function i(e){var t=e.dimensionTree,n=e.activeDimension,r=e.hierarchy;if(v(this,i),!r)throw Error('attribute "hierarchy" must be defined');this.dimensionTree=t instanceof P?t:P.createDimensionTree(t),this.activeDimension=n||this.dimensionTree.getTreeValue().dimension,this.hierarchy=r}return t(i,[{key:"getDimensionTree",value:function(){return this.dimensionTree}},{key:"hasDimension",value:function(e){return!!this.dimensionTree.getDimensionTreeByDimension(e)}},{key:"getActiveDimension",value:function(){return this.activeDimension}},{key:"setActiveDimension",value:function(e){this.activeDimension=e}},{key:"getHierarchy",value:function(){return this.hierarchy}}],[{key:"createDimensionHierarchy",value:function(e){return new i(e)}}]),i}(),M=function(){function E(){v(this,E)}return t(E,null,[{key:"anotherBuild",value:function(t,n,e,r,i){e.forEach(function(e){E.anotherBuildOne(e,n,r,t,i)})}},{key:"anotherBuildOne",value:function(e,n,r,i,o){e.tracePostOrder(function(e,t){E.processDimension(t,n,r,i,o)})}},{key:"processDimension",value:function(e,t,n,r,i){var o,a=e.getTreeValue(),u=a.dimension,s=a.keyProps,c=void 0===s?[]:s,l=a.otherProps,f=void 0===l?[]:l,h=a.members,m=a.foreignKey,y=a.primaryKey,v=e.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),d=e.getChildTrees().map(function(e){return e.getTreeValue().dimension}),p=h.length,b=[i,y,m,p,r,t,u,c,f,t,n];if(v.length){var g,T=e.getDimensionTreeByDimension(d[0]).getTreeValue(),O=T.members;g=E.mapFilter(v[0],t,O,T),o=E.makeMemberListLevel.apply(null,b.concat([v,g]))}else o=E.makeMemberList.apply(null,b);function k(t,e,n){e.forEach(function(e){e!==n&&delete t[e]})}t.forEach(function(e){k(e,c,i),k(e,f,i)}),o.forEach(function(e){a.addMember(e)})}},{key:"mapFilter",value:function(n,r,e,i){var o=[];return e.forEach(function(t){var e=r.filter(function(e){return e[n]==i.getMemberPrimaryKey(t)});o.push(e)}),o}},{key:"makeMemberListLevel",value:function(t,i,o,a,u,e,s,c,l,f,h,m,n){var y=[],v=0;return n.forEach(function(e){if(e.length){var n=E.makeMemberList(t,i,o,a,u,e,s,c,l,f,h,v);v+=n.length;var r=e[0];m.forEach(function(t){n.forEach(function(e){e[t]=r[t],e[i]=a+y.length+1,y.push(e)}),e.forEach(function(e){delete e[t]})})}}),y}},{key:"makeMemberList",value:function(r,i,o,e,a,u,t){var s=7<arguments.length&&void 0!==arguments[7]?arguments[7]:[],c=8<arguments.length&&void 0!==arguments[8]?arguments[8]:[],n=9<arguments.length?arguments[9]:void 0,l=10<arguments.length?arguments[10]:void 0,f=11<arguments.length&&void 0!==arguments[11]?arguments[11]:0,h={},m={},y=[];return l.filter(function(e){return-1===n.indexOf(e)}).forEach(function(t){var e=a.find(function(e){return e[r]===t[r]}),n=E.createKeyFromProps(s,e);n in m||(m[n]=++f)}),u.forEach(function(e){var t=E.createKeyFromProps(s,e);t in h||t in m||(h[t]=++f);var n=h[t];e[o]=n}),Object.keys(h).forEach(function(e){var t=h[e],n=u.find(function(e){return e[o]===t}),r=D.create(t,[].concat(s).concat(c),n,i);y.push(r)}),y}},{key:"createKeyFromProps",value:function(e,t){return e.map(function(e){return t[e]}).join(",")}},{key:"destroy",value:function(n,e,r,i){var o=this;e.forEach(function(e){var t=n.indexOf(e);-1!==t&&n.splice(t,1)}),e.forEach(function(t){r.forEach(function(e){E.travers([t],e,[E.removeMembers.bind(o,i,e),E.restoreCell])})})}},{key:"denormalize",value:function(e,n){var t=[];return e.forEach(function(e){t.push(d({},e))}),t.forEach(function(t){n.forEach(function(e){E.travers([t],e,[E.restoreCell])})}),t}},{key:"restoreCell",value:function(e,t,n,r,i,o){var a=new D(e);o.deleteMemberId(a),delete r[i],Object.assign(r,a)}},{key:"removeMembers",value:function(e,t,n,r,i,o,a){var u=e.dice(y({},i,n)),s=t.getDimensionTreeByDimension(i).getTreeValue();u.getCells().length||s.removeMember(n)}},{key:"travers",value:function(e,t){var l=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(){};e.forEach(function(c){t.tracePreOrder(function(e,t){var n,r,i,o,a,u,s;r=c,i=(n=e).dimension,o=n.members,a=n.foreignKey,u=r[a],s=o.find(function(e){return n.getMemberPrimaryKey(e)===u}),l.forEach(function(e){e(s,o,i,r,a,n)})})})}},{key:"destroyDimensionTree",value:function(e,t,n,r){E.travers(e,n,[E.removeMembers.bind(this,r,n),E.restoreCell])}}]),E}(),x=function e(t){v(this,e),Object.assign(this,t)},K=function(){function n(){v(this,n)}return t(n,null,[{key:"union",value:function(){var t={};return Array.prototype.slice.call(arguments).forEach(function(e){n.add(t,e)}),t}},{key:"add",value:function(t,n){Object.keys(n).forEach(function(e){t[e]||(t[e]=[]),Array.prototype.push.apply(t[e],n[e])})}}]),n}(),V="object"==("undefined"==typeof global?"undefined":o(global))&&global&&global.Object===Object&&global,A="object"==("undefined"==typeof self?"undefined":o(self))&&self&&self.Object===Object&&self,S=(V||A||Function("return this")()).Symbol,F=Object.prototype,H=F.hasOwnProperty,B=F.toString,R=S?S.toStringTag:void 0;var I=Object.prototype.toString;var L="[object Null]",U="[object Undefined]",_=S?S.toStringTag:void 0;function N(e){return null==e?void 0===e?U:L:_&&_ in Object(e)?function(e){var t=H.call(e,R),n=e[R];try{e[R]=void 0}catch(e){}var r=B.call(e);return t?e[R]=n:delete e[R],r}(e):(t=e,I.call(t));var t}var W,z,q=(W=Object.getPrototypeOf,z=Object,function(e){return W(z(e))});var G="[object Object]",J=Function.prototype,Q=Object.prototype,X=J.toString,Y=Q.hasOwnProperty,Z=X.call(Object);function $(e){if(null==(t=e)||"object"!=o(t)||N(e)!=G)return!1;var t,n=q(e);if(null===n)return!0;var r=Y.call(n,"constructor")&&n.constructor;return"function"==typeof r&&r instanceof r&&X.call(r)==Z}var ee=function(){function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,c),!($(e)||e instanceof c))throw TypeError("The argument must be plain object or instance of Cube");var t=e.dimensionHierarchies,n=void 0===t?[]:t,r=e.cellTable,i=void 0===r?[]:r,o=e.defaultFactOptions,a=void 0===o?{}:o,u=e.factPrimaryKey,s=void 0===u?"id":u;this.defaultFactOptions=a,this.factPrimaryKey=s,this.dimensionHierarchies=n.map(function(e){return e.hierarchy?e instanceof C?e:C.createDimensionHierarchy(e):e.dimensionTable?e instanceof P?e:P.createDimensionTree(e):e instanceof w?e:w.createDimensionTable(e)}),this.cellTable=i.map(function(e){return e instanceof O?e:k.isEmptyCell(e)?new k(e):new O(e)})}return t(c,[{key:"slice",value:function(e,t){return this.dice(y({},e,t))}},{key:"dice",value:function(a){var u=this;if(!($(a)||a instanceof x))throw TypeError("The argument must be a plain object");var s={};Object.keys(a).forEach(function(e){var t,r,i,o,n=a[e];t=n,n=Array.isArray(t)?t:[t],r=n,i=re.call(u,e).getTreeValue(),o=i.members,r.forEach(function(t,e){var n=o.find(function(e){return i.getMemberPrimaryKey(e)===i.getMemberPrimaryKey(t)});if(!n)throw RangeError("Not found member by id ".concat(i.getMemberPrimaryKey(n)));r instanceof D||(r[e]=n)}),n=r,s[e]=n});var e=Object.keys(s),t=this.dimensionHierarchies.length;if(e.length>t)throw Error("Set must have a size not more than ".concat(t," dimensions"));var c=[],n=e.map(function(i){var o,e=s[i].map(function(e){var t=re.call(u,i),n=t.cloneDimensionTreeWithoutMembers();t.projectDrillDown(n,e),t.projectDrillUp(n,e),o?o.unionDimensionTree(n):o=n;var r=o.getRoot().getTreeValue();return y({},r.dimension,r.members)});return o&&c.push(o),K.union.apply(K,m(e))}),l=this.getCells(),f=function(o,a){return!Object.keys(a).some(function(e){var t=a[e],n=re.call(u,e).getTreeValue(),r=n.foreignKey,i=n.primaryKey;return!t.find(function(e){return e[i]===o[r]})})};n.forEach(function(t){l=l.filter(function(e){return f(e,t)})});var h=[];return this.dimensionHierarchies.forEach(function(t){var n=!1;if(c.forEach(function(e){t.getTreeValue().dimension===e.getTreeValue().dimension&&(h.push(e),n=!0)}),!n){var e=t.getTreeValue(),r=e.members,i=e.dimension,o=P.createProxyDimensionTree(t);r.forEach(function(t){var n=!1;(l.forEach(function(e){f(e,y({},i,[t]))&&(n=!0)}),n)||-1!==o.getTreeValue().members.indexOf(t)&&o.removeProjectionOntoMember(t)}),h.push(o)}}),new te({cellTable:l,dimensionHierarchies:h,originalCube:this.originalCube||this,previousCube:this})}},{key:"drillUp",value:function(e,t){var n=ne.call(this,e);return n&&n.hasDimension(t)&&n.setActiveDimension(t),this}},{key:"drillDown",value:function(e,t){var n=ne.call(this,e);return n&&n.hasDimension(t)&&n.setActiveDimension(t),this}},{key:"getFacts",value:function(){return function(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.getCells(),e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],t=M.denormalize(r,ie.call(this));e&&t.forEach(function(e,t){r[t]instanceof k&&delete e[n.factPrimaryKey]});return t}.call(this,this.getCells())}},{key:"addFacts",value:function(e){if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");e.forEach(function(e,t){if(!t.hasOwnProperty(e))throw new f(e)}.bind(null,this.factPrimaryKey));var t=e.map(function(e){return new O(e)});[].push.apply(this.getCells(),t);var n=this.getFacts();return M.anotherBuild(n,t,ie.call(this),this.getCells(),this.factPrimaryKey),this}},{key:"removeFacts",value:function(e){if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");var n=this.getCells(),r=this.factPrimaryKey,t=e.map(function(t){return n.find(function(e){return e[r]===t[r]})});this.removeCells(t)}},{key:"getCells",value:function(){return this.cellTable}},{key:"removeCells",value:function(e){if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");e.forEach(function(e){if(!(e instanceof O))throw TypeError("The list of cells must contain only instances of Cell and EmptyCell")}),M.destroy(this.getCells(),e,this.dimensionHierarchies,this)}},{key:"getDimensionMembers",value:function(e){if("string"!=typeof e)throw TypeError("The first argument must be string");return re.call(this,e).getTreeValue().members}},{key:"addDimensionMember",value:function(e){var o=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:{},n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:{};if("string"!=typeof e)throw TypeError("The first argument must be instance of string");if(!($(t)&&$(a)&&$(u)&&$(n)))throw TypeError("The arguments after the first must be plain objects");Object.keys(a).forEach(function(e){var t=a[e],n=o.getDimensionMembers(e),r=re.call(o,e).getTreeValue(),i=t[r.primaryKey];if(!n.find(function(e){return i===r.getMemberPrimaryKey(e)}))throw new p(e,i)});var s=re.call(this,e),r=s.getChildTrees(),c=s.getTreeValue(),i=c.foreignKey,l={};r.forEach(function(e){var t=e.getTreeValue(),n=t.dimension,r=t.foreignKey,i=t.primaryKey,o=a[n];if(!o)throw new p(n);l[r]=o[i]});var f=Object.assign({},t,l),h=s.createMember(f),m=i;s.traceUpOrder(function(e,t){if(s!==t){var n=e.dimension,r=e.foreignKey,i=y({},m,c.getMemberPrimaryKey(h));Object.assign(i,u[n]),h=t.createMember(i),m=r}}),this.fillEmptyCells(n)}},{key:"removeDimensionMember",value:function(e,t){if("string"!=typeof e)throw TypeError("The first argument must be instance of string");if(!(t instanceof D))throw TypeError("The second argument must be instance of Member");var a=re.call(this,e),u=a.removeProjectionOntoMember(t),s=this.getCells();Object.keys(u).map(function(e){var t,n,r,i,o;(n=u[t=e],r=[],i=a.getDimensionTreeByDimension(t).getTreeValue(),o=i.foreignKey,s.forEach(function(t){n.forEach(function(e){t[o]==i.getMemberPrimaryKey(e)&&r.push(t)})}),r).forEach(function(e){var t=s.indexOf(e);-1!==t&&s.splice(t,1)})})}},{key:"addDimensionHierarchy",value:function(e){var t=P.createDimensionTree(e);this.dimensionHierarchies.push(t),M.anotherBuildOne(t,this.getCells(),this.getCells(),this.getCells(),this.factPrimaryKey)}},{key:"removeDimensionHierarchy",value:function(e){if(!(e instanceof P))throw TypeError("The argument must be instance of DimensionTree");M.destroyDimensionTree(this.getCells(),this.getCells(),e,this),this.dimensionHierarchies.splice(this.dimensionHierarchies.indexOf(e),1)}},{key:"createEmptyCells",value:function(){var o=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!$(n))throw TypeError("Cell option argument must be a pure object");var a=[];return c.cartesian(this).forEach(function(r){if(!o.dice(r).getCells().length){var i={};Object.keys(r).forEach(function(e){var t=re.call(o,e).getTreeValue(),n=t.foreignKey;i[n]=t.getMemberPrimaryKey(r[e])});var e=d({},o.defaultFactOptions,n,i),t=k.createEmptyCell(e);a.push(t)}}),a}},{key:"getEmptyCells",value:function(){return this.getCells().filter(function(e){return k.isEmptyCell(e)})}},{key:"isEmptyCell",value:function(e){return k.isEmptyCell(e)}},{key:"addEmptyCells",value:function(e){var n=this;if(!Array.isArray(e))throw TypeError("The argument must be instance of Array");e.forEach(function(e,t){if(!n.isEmptyCell(e))throw TypeError("Some item in list of argument is not instances of EmptyCell, index: ".concat(t))}),[].push.apply(this.getCells(),e)}},{key:"fillEmptyCells",value:function(e){if(!(n=this,r=ee.cartesian(n),i=[],r.forEach(function(e){1<n.dice(e).getFacts().length&&i.push(e)}),i).length){var t=this.createEmptyCells(e);this.addEmptyCells(t)}var n,r,i}},{key:"isSubCube",value:function(){return this instanceof te}}],[{key:"cartesian",value:function(e){if(!(e instanceof c))throw TypeError("The argument must be instance of Cube");var t=function e(t,n){for(var r=arguments.length,i=new Array(2<r?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];return n?e.apply(void 0,[(a=t,u=n,(s=[]).concat.apply(s,m(a.map(function(t){return u.map(function(e){return[].concat(t,e)})}))))].concat(i)):t;var a,u,s},i=[],n=e.dimensionHierarchies.map(function(e){return e.getTreeValue()}).map(function(e){return i.push(e.dimension),e.members}),o=[];return n.length&&(1<n.length?t.apply(null,n):n[0].map(function(e){return[e]})).forEach(function(n){var r={};return i.forEach(function(e,t){r[e]=n[t]}),o.push(new x(r)),r}),o}}]),c}(),te=function(e){function o(e){var t,n=e.originalCube,r=e.previousCube,i=a(e,["originalCube","previousCube"]);return v(this,o),(t=l(this,s(o).call(this,i))).originalCube=n,t.previousCube=r,t}return i(o,ee),o}();function ne(t){return this.dimensionHierarchies.find(function(e){return e.getHierarchy()===t})}function re(t){var n;if(this.dimensionHierarchies.forEach(function(e){e.getDimensionTreeByDimension(t)&&(n=e.getDimensionTreeByDimension(t))}),!n)throw RangeError("Not existed dimension: ".concat(t));return n}function ie(){return this.dimensionHierarchies.map(function(e){return e.getDimensionTree?e.getDimensionTree():e})}return ee});
//# sourceMappingURL=cube.min.js.map
