/*!
 * Version: "0.6.0"
 * Copyright Â© 2018 Orlov Leonid. All rights reserved. Contacts: <feonitu@yandex.ru>
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cube=t():e.Cube=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=2)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.ENTITY_ID="id"},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(0),a=function(){function e(t){r(this,e),o(this,t)}return i(e,null,[{key:"create",value:function(t,n,r){if(this!==e&&!e.isPrototypeOf(this))throw Error("this.constructor must be prototype of Member");var o={};return o[u.ENTITY_ID]=t,n.forEach(function(e){e!==u.ENTITY_ID&&(o[e]=r[e])}),new this(o)}}]),e}();t.default=a},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(9),l=r(f),s=n(0),p=n(1),y=(r(p),n(10)),d=r(y),b=n(11),h=r(b),v=n(8),m=r(v),O=n(4),g=n(14),_=r(g),j=n(7),T=(r(j),n(15)),w=r(T),P=n(16),E=r(P),k=n(18),D=r(k),M=n(3),I=r(M),x=function(){function e(t){u(this,e);var n=t.dimensionHierarchies,r=t.cellTable,o=void 0===r?[]:r;this.dimensionHierarchies=n.map(h.default.createDimensionTree),this.cellTable=new w.default(o)}return c(e,[{key:"addFacts",value:function(e){var t=new m.default(e),n=t.map(function(e){return new I.default(e)});this.cellTable.addCells(n);var r=this.denormalize(this.getMeasure());_.default.anotherBuild(r,n,this.dimensionHierarchies,this.cellTable)}},{key:"removeFacts",value:function(e){var t=this.cellTable,n=e.map(function(e){return t.find(function(t){return t[s.ENTITY_ID]===e[s.ENTITY_ID]})});_.default.destroy(t,n,this.dimensionHierarchies,this)}},{key:"getFacts",value:function(){return this.denormalize(this.getMeasure())}},{key:"getDimensionMembers",value:function(e){return this.findDimensionTreeByDimension(e).getTreeValue().members}},{key:"getFactsBySet",value:function(e){return this.denormalize(this.getMeasureBySet(e))}},{key:"getMeasure",value:function(){return this.cellTable}},{key:"getMeasureBySet",value:function(e){return this.projection(e).cellTable}},{key:"getDimensionMembersBySet",value:function(e,t){var n=this.projection(t),r=n.cellTable;return this.getDimensionMembersFromCells(e,r)}},{key:"projection",value:function(t){var n=this;if(t){var r=this.getMeasure();if(0===Object.keys(t).length)return{cellTable:r};var u={};Object.keys(t).forEach(function(e){u[e]=Array.isArray(t[e])?t[e]:[t[e]]});var a=Object.keys(u).map(function(e){var t=u[e].map(function(t){var r=n.findDimensionTreeByDimension(e),o=r.createProjectionOntoMember(e,t),u=o.getRoot().getTreeValue();return i({},u.dimension,u.members)});return D.default.union.apply(D.default,o(t))}),c=r,f=function(t,n){return!Object.keys(n).some(function(r){var o=n[r],i=e.genericId(r);return!o.find(function(e){return e[s.ENTITY_ID]===t[i]})})};return a.forEach(function(e){c=c.filter(function(t){return f(t,e)})}),{cellTable:c}}}},{key:"findDimensionTreeByDimension",value:function(e){var t=void 0;return this.dimensionHierarchies.forEach(function(n){n.getDimensionTreeByDimension(e)&&(t=n.getDimensionTreeByDimension(e))}),t}},{key:"getDimensionMembersFromCells",value:function(t,n){var r=this.findDimensionTreeByDimension(t),o=void 0,i=void 0;r.isRoot()?(o=r.getTreeValue().members,i=r.getTreeValue().dimension):(o=r.getRoot().getTreeValue().members,i=r.getRoot().getTreeValue().dimension);var u=e.genericId(i),a=[];if(n.forEach(function(e){o.forEach(function(t){e[u]===t[s.ENTITY_ID]&&-1===a.indexOf(t)&&a.push(t)})}),r.isRoot())return a;var c=a,f=!1,l=i;return r.getRoot().tracePreOrder(function(e,n){n.isRoot()||(f||(c=r.rollUpDimensionMembers(l,c),l=e.dimension),e.dimension===t&&(f=!0))}),c}},{key:"cartesian",value:function(){var e=function(e,t){var n;return(n=[]).concat.apply(n,o(e.map(function(e){return t.map(function(t){return[].concat(e,t)})})))},t=function t(n,r){for(var o=arguments.length,i=Array(o>2?o-2:0),u=2;u<o;u++)i[u-2]=arguments[u];return r?t.apply(void 0,[e(n,r)].concat(i)):n},n=[],r=this.dimensionHierarchies.map(function(e){return e.getTreeValue()}).map(function(e){return n.push(e.dimension),e.members}),i=t.apply(null,r),u=new E.default;return i.forEach(function(e){var t={};return n.forEach(function(n,r){t[n]=e[r]}),u.addTuple(t),t}),u}},{key:"denormalize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getMeasure(),t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=_.default.denormalize(e,this.dimensionHierarchies);return t&&n.forEach(function(t,n){e[n]instanceof l.default&&delete t[s.ENTITY_ID]}),n}},{key:"residuals",value:function(){var e=this,t=this.cartesian(),n=[];return t.forEach(function(t){e.getFactsBySet(t).length>1&&n.push(t)}),n}},{key:"addDimensionMember",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},c=arguments[4];if("string"!=typeof t)throw TypeError("parameter dimension expects as string: "+t);var f={};Object.keys(r).forEach(function(e){var t=r[e],n=o.getDimensionMembers(e),i=t[s.ENTITY_ID],u=n.find(function(e){return i===e[s.ENTITY_ID]});if(!u)throw new O.CantAddMemberRollupException(e,i);f[e]=u});var l=this.findDimensionTreeByDimension(t);l.getChildTrees().forEach(function(t){var o=t.getTreeValue(),i=o.dimension,u=r[i];if(!u)throw new O.CantAddMemberRollupException(i);n[e.genericId(i)]=u[s.ENTITY_ID]});var p=this._createMember(l,n),y=t;l.traceUpOrder(function(t){if(l!==t){var n=t.getTreeValue(),r=n.dimension,c=i({},e.genericId(y),p[s.ENTITY_ID]);a(c,u[r]),p=o._createMember(t,c),y=r}}),this.fill(c)}},{key:"removeDimensionMember",value:function(t,n){var r=this.findDimensionTreeByDimension(t),o=r.removeDimensionMember(t,n),i=this.getMeasure(),u=function(t,n){var r=[],o=e.genericId(t);return i.forEach(function(e){n.forEach(function(t){e[o]==t[s.ENTITY_ID]&&r.push(e)})}),r};Object.keys(o).map(function(e){u(e,o[e]).forEach(function(e){i.removeCell(e)})})}},{key:"fill",value:function(e){var t=this;if(!this.residuals().length){this.cartesian().forEach(function(n){t.getMeasureBySet(n).length||t._createNormalizeData(n,e)})}}},{key:"unfilled",value:function(){var e=this,t=this.cartesian(),n=[];return t.forEach(function(t){0===e.getFactsBySet(t).length&&n.push(t)}),n}},{key:"_createNormalizeData",value:function(t,n){var r={};Object.keys(t).forEach(function(n){r[e.genericId(n)]=t[n][s.ENTITY_ID]}),r=a({},r,n);var o=new l.default(r);this.getMeasure().addCell(o)}},{key:"_createMember",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=t.getTreeValue(),o=r.keyProps,i=(r.dimension,t.getChildTrees().map(function(e){return e.getTreeValue().dimension})),u=[];i.forEach(function(t){u.push(e.genericId(t))});var a=t.getTreeValue().members,c=e.reduceId(a),f=d.default.create(c,o.concat(u),n);return a.addMember(f),f}}],[{key:"create",value:function(t,n){if(!e.isPrototypeOf(this)&&e!==this)throw new O.CreateInstanceException;var r=new this({dimensionHierarchies:n});return r.addFacts(t),r}},{key:"genericId",value:function(e){return e+"_"+s.ENTITY_ID}},{key:"reduceId",value:function(e){return e.length?e.reduce(function(e,t){return e[s.ENTITY_ID]>t[s.ENTITY_ID]?e:t},0).id+1:1}}]),e}();t.default=x},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(0),c=n(6),f=function(e){return e&&e.__esModule?e:{default:e}}(c),l=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,[{key:"deleteProps",value:function(e){var t=this;e.forEach(function(e){e!==a.ENTITY_ID&&delete t[e]})}}]),t}(f.default);t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.NotCompletelySpaceException=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.message='Not completely defined space for added member, not found member for dimension: "'+e+'"',n}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.CantAddMemberRollupException=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.message="Can't add member, rollup dimension: "+e+" with id: "+n+" not found",i}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.NotFoundFactId=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.message="Not found fact id",e}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.CreateInstanceException=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.message="this must have prototype of Cube",e}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.DimensionException=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.message='For the name "'+e+'" the dimension is already set',n}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.handleError=function(e){throw e instanceof Error&&(e.message="[Cube] "+e.message),e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(0),f=n(1),l=function(e){return e&&e.__esModule?e:{default:e}}(f),s=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&(e=e.map(function(e){return new l.default(e)}),u(n,e)),n}return i(t,e),a(t,[{key:"filter",value:function(){return[].filter.apply(this,arguments)}},{key:"addMember",value:function(e){this.indexOf(-1===e[c.ENTITY_ID])&&this.push(e)}},{key:"removeMember",value:function(e){var t=this.indexOf(e);if(-1===t)throw new Error("represented member was not found",e);this.splice(t,1)}},{key:"setMembers",value:function(e){this.splice(0,this.length),u(this,e)}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(0),u=n(4),a=n(7),c=function(e){return e&&e.__esModule?e:{default:e}}(a),f=function(e){var t=void 0===e?"undefined":o(e);return"object"!==t&&"function"!==t&&"undefined"!==t||null===e},l=function e(t){r(this,e);try{for(var n in t){if(!t.hasOwnProperty(n))return;f(t[n])?this[n]=t[n]:c.default.warn('[Fact] value of prop "'+n+'" has an unspecified value: '+t[n])}if(!(i.ENTITY_ID in this))throw new u.NotFoundFactId}catch(e){(0,u.handleError)(e)}};t.default=l},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=console,o={log:function(e){r.log("[Cube] "+e)},warn:function(e){r.warn("[Cube] "+e)},warnOnce:function(){var e={};return function(t){e[t]||(e[t]=!0,r.warn("[Cube] "+t))}}()};t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=n(6),c=function(e){return e&&e.__esModule?e:{default:e}}(a),f=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&u(n,e.map(function(e){return new c.default(e)})),n}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function u(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}Object.defineProperty(t,"__esModule",{value:!0});var a=n(3),c=function(e){return e&&e.__esModule?e:{default:e}}(a),f=function(e){function t(e,n){return r(this,t),e.id||(e.id=u()),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return i(t,e),t}(c.default);t.default=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},c=n(1),f=function(e){return e&&e.__esModule?e:{default:e}}(c),l=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),u(t,null,[{key:"create",value:function(e,n,r){var o={};return n.forEach(function(e){o[e]=r.hasOwnProperty(e)?r[e]:null}),a(t.__proto__||Object.getPrototypeOf(t),"create",this).call(this,e,n,o)}}]),t}(f.default);t.default=l},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(12),l=r(f),s=n(13),p=r(s),y=(n(4),n(2)),d=r(y),b=n(0),h=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e.dimensionTable,u=e.dependency,c=void 0===u?[]:u,f=e.parentNode,s=void 0===f?null:f;return Object.defineProperties(n,{dimensionTable:{value:new l.default(r),editable:!1,enumerable:!0},parentNode:{value:s,enumerable:!1,editable:!1},dependency:{value:c.map(function(e){return new t(a({},e,{parentNode:n}))}),enumerable:!0,editable:!1}}),n}return u(t,e),c(t,[{key:"getTreeValue",value:function(){return this.dimensionTable}},{key:"getParentTree",value:function(){return this.parentNode}},{key:"getChildTrees",value:function(){return this.dependency}},{key:"getDimensionTreeByDimension",value:function(e){return this.getRoot().searchTreeByTreeValue(function(t){return t.getTreeValue().dimension===e})}},{key:"createProjectionOntoMember",value:function(e,n){var r=this,o=new t(this.getRoot());o.tracePostOrder(function(e,t){t.getTreeValue().clearMemberList()});var i=this.getDimensionTreeByDimension(e),u=void 0,a=void 0;return i.traceUpOrder(function(e){var t=e.getTreeValue(),c=t.dimension,f=e==i?[n]:r.drillDownDimensionMembers(a,u);o.getDimensionTreeByDimension(c).getTreeValue().setMemberList(f),a=c,u=f}),o}},{key:"removeDimensionMember",value:function(e,t){var n=this,r=this.getDimensionTreeByDimension(e),o=r.createProjectionOntoMember(e,t),i={},u={};o.tracePostOrder(function(e){var t=e.dimension,n=e.members;i[t]=n}),1===r.getTreeValue().members.length&&r.tracePreOrder(function(e){var t=e.getTreeValue(),n=t.members,r=t.dimension;i[r]=n}),Object.keys(i).forEach(function(e){var t=n.getDimensionTreeByDimension(e),r=t.getTreeValue().members;i[e].forEach(function(e){r.removeMember(e)})});var a=o.getRoot().getTreeValue(),c=a.dimension,f=a.members;return u[c]=f,u}},{key:"drillDownDimensionMembers",value:function(e,t){var n=this.getRoot().getDimensionTreeByDimension(e);if(n.isRoot())return t;var r=n.getParentTree(),o=r.getTreeValue(),i=o.members,u=d.default.genericId(e),a=[];return t.forEach(function(e){i.forEach(function(t){t[u]===e[b.ENTITY_ID]&&-1===a.indexOf(t)&&a.push(t)})}),a}},{key:"rollUpDimensionMembers",value:function(e,t){var n=this.getRoot().getDimensionTreeByDimension(e);if(n.isExternal())return t;var r=n.getChildTrees()[0],o=r.getTreeValue(),i=o.members,u=o.dimension,a=d.default.genericId(u),c=[];return t.forEach(function(e){i.forEach(function(t){e[a]===t[b.ENTITY_ID]&&-1===c.indexOf(t)&&c.push(t)})}),c}}],[{key:"createDimensionTree",value:function(e){var n=new t(e);return n.tracePostOrder(function(e,t){e.dependencyNames=t.getChildTrees().map(function(e){return e.getTreeValue().dimension})}),n}}]),t}(p.default);t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),u=function(e){return e&&e.__esModule?e:{default:e}}(i),a=function(){function e(t){var n=t.dimension,o=t.keyProps,i=t.otherProps,a=void 0===i?[]:i,c=t.dependencyNames,f=void 0===c?[]:c,l=t.members,s=void 0===l?[]:l;if(r(this,e),!n||!o)throw Error("Bad definition DimensionTable, params 'dimension' and 'keyProps' is required");this.dimension=n,this.keyProps=o.map(function(e){return e}),this.otherProps=a.map(function(e){return e}),this.dependencyNames=f,this.members=new u.default(s)}return o(e,[{key:"setMemberList",value:function(e){this.members.setMembers(e)}},{key:"clearMemberList",value:function(){this.members=new u.default([])}}]),e}();t.default=a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e)}return o(e,[{key:"getTreeValue",value:function(){throw"abstract method"}},{key:"getParentTree",value:function(){throw"abstract method"}},{key:"getChildTrees",value:function(){throw"abstract method"}},{key:"isExternal",value:function(){return!this.getChildTrees().length}},{key:"isFirstLevel",value:function(){return!this.isRoot()&&null===this.getParentTree().getParentTree()}},{key:"isRoot",value:function(){return null===this.getParentTree()}},{key:"getRoot",value:function(){var e=this;return this.traceUpOrder(function(t){t.isRoot()&&(e=t)}),e}},{key:"searchTreeByTreeValue",value:function(e){var t=void 0;return this.tracePostOrder(function(n,r){e(r)&&(t=r)}),t}},{key:"traceUpOrder",value:function(e){!function t(n){var r=n.getParentTree();e(n),null!==r&&t(r)}(this)}},{key:"tracePostOrder",value:function(e){!function t(n){var r=n.getChildTrees(),o=n.getTreeValue();r.length&&r.forEach(function(e){t(e)}),e(o,n)}(this)}},{key:"tracePreOrder",value:function(e){!function t(n){var r=n.getChildTrees(),o=n.getTreeValue();e(o,n),r.length&&r.forEach(function(e){t(e)})}(this)}}]),e}();t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(5),f=(r(c),n(1)),l=r(f),s=n(0),p=n(2),y=r(p),d=n(8),b=r(d),h=function(){function e(){i(this,e)}return a(e,null,[{key:"anotherBuild",value:function(t,n,r,o){r.forEach(function(r){r.tracePostOrder(function(r,i){e.processDimension(i,n,o,t)})})}},{key:"processDimension",value:function(t,n,r,o){var i=t.isFirstLevel(),u=t.getTreeValue(),a=u.dimension,c=u.keyProps,f=void 0===c?[]:c,l=u.otherProps,s=void 0===l?[]:l,p=t.getChildTrees().map(function(e){return e.getTreeValue().dimension}),y=void 0,d=void 0;y=t.getTreeValue().members;var b=y.length,h=[b,o,n,a,f,s,n,i,r];if(p.length){var v=[],m=t.getDimensionTreeByDimension(p[0]).getTreeValue().members;v=e.mapFilter(p,n,m),d=e.makeMemberListDependency.apply(null,h.concat([p,v]))}else d=e.makeMemberList.apply(null,h);var O=[].concat(f,s);n.forEach(function(e){e.deleteProps(O)}),d.forEach(function(e){y.addMember(e)})}},{key:"mapFilter",value:function(e,t,n){var r=y.default.genericId(e),o=[];return n.forEach(function(e){var n=t.filter(function(t){return t[r]==e[s.ENTITY_ID]});o.push(n)}),o}},{key:"makeMemberListDependency",value:function(t,n,r,o,i,u,a,c,f,l,p){var d=[],b=0;return p.forEach(function(r){if(r.length){var p=e.makeMemberList(t,n,r,o,i,u,a,c,f,b);b+=p.length;var h=r[0];l.forEach(function(e){var n=y.default.genericId(e);p.forEach(function(e){e[n]=h[n],e[s.ENTITY_ID]=t+d.length+1,d.push(e)}),r.forEach(function(e){delete e[n]})})}}),d}},{key:"makeMemberList",value:function(t,n,r,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments[6],c=(arguments[7],arguments[8]),f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:0,p={},d={},b=[],h=[].concat(i,u);return c.filter(function(e){return-1===a.indexOf(e)}).forEach(function(t){var r=n.find(function(e){return e[s.ENTITY_ID]===t[s.ENTITY_ID]}),o=e.createKeyFromProps(i,r);o in d||(d[o]=++f)}),r.forEach(function(t){var n=e.createKeyFromProps(i,t);n in p||n in d||(p[n]=++f);var r=p[n];t[y.default.genericId(o)]=r}),Object.keys(p).forEach(function(e){var t=p[e],n=y.default.genericId(o),i=r.find(function(e){return e[n]===t}),u=l.default.create(t,h,i);b.push(u)}),b}},{key:"createKeyFromProps",value:function(e,t){return e.map(function(e){return t[e]}).join(",")}},{key:"destroy",value:function(e,t,n,r){t.forEach(function(t){e.removeCell(t)});var i=function(e,t,n){r.projection(o({},n,e)).cellTable.length||t.removeMember(e)};this.denormalize(t,n,i)}},{key:"denormalize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=new b.default;e.forEach(function(e){r.push(u({},e))});var o=function(e,t){var r=e.getTreeValue(),o=r.dimension,i=r.members,a=y.default.genericId(o),c=t[a],f=i.find(function(e){return e[s.ENTITY_ID]===c});n(f,i,o);var l=u({},f);delete l[s.ENTITY_ID],delete t[a],u(t,l)};return r.forEach(function(e){t.forEach(function(t){t.tracePreOrder(function(t,n){o(n,e)})})}),r}}]),e}();t.default=h},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(3),f=function(e){return e&&e.__esModule?e:{default:e}}(c),l=n(0),s=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&u(n,e.map(function(e){return new f.default(e)})),n}return i(t,e),a(t,[{key:"findById",value:function(e){return this.find(function(t){return t[l.ENTITY_ID]===e})}},{key:"addCell",value:function(e){this.push(e)}},{key:"addCells",value:function(e){var t=this;e.forEach(function(e){t.addCell(e)})}},{key:"removeCell",value:function(e){var t=this.indexOf(e);this.splice(t,1)}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var u=o.get;if(void 0!==u)return u.call(r)},f=n(17),l=function(e){return e&&e.__esModule?e:{default:e}}(f),s=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&u(n,e.map(function(e){return new l.default(e)})),n}return i(t,e),a(t,[{key:"addTuple",value:function(e){this.push(new l.default(e))}},{key:"forEach",value:function(){return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"forEach",this).apply(this,arguments)}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=s},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function e(t){r(this,e),o(this,t)};t.default=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(5),u=function(e){return e&&e.__esModule?e:{default:e}}(i),a=function(){function e(t){var n=this;r(this,e),t&&this.getDimensionList.call(t).forEach(function(e){var r=t[e];n.setMemberList(e,r)})}return o(e,[{key:"setMemberList",value:function(e,t){this[e]=new u.default(t)}},{key:"getDimensionList",value:function(){return Object.getOwnPropertyNames(this)}}],[{key:"union",value:function(){var t={};return[].concat(Array.prototype.slice.call(arguments)).forEach(function(n){e.add(t,n)}),t}},{key:"add",value:function(e,t){Object.keys(t).forEach(function(n){e[n]||(e[n]=[]),Array.prototype.push.apply(e[n],t[n])})}}]),e}();t.default=a}]).default});