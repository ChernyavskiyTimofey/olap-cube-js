/*!
 * Version: "0.13.0"
 * Copyright Â© 2018 Orlov Leonid. All rights reserved. Contacts: <feonitu@yandex.ru>
 * 
 */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Cube=t():e.Cube=t()}("undefined"!=typeof self?self:this,function(){return function(e){function t(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,t),o.l=!0,o.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=8)}([function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});t.NotCompletelySpaceException=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.message='Not completely defined space for added member, not found member for dimension: "'+e+'"',n}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.CantAddMemberRollupException=function(e){function t(e,n){r(this,t);var i=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return i.message="Can't add member, rollup dimension: "+e+" with id: "+n+" not found",i}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.NotFoundFactId=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.message="Not found fact id",e}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.CreateInstanceException=function(e){function t(){r(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.message="this must have prototype of Cube",e}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.DimensionException=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.message='For the name "'+e+'" the dimension is already set',n}return i(t,e),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Error)),t.handleError=function(e){throw e instanceof Error&&(e.message="[Cube] "+e.message),e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=function(){function e(t){r(this,e),o(this,t)}return i(e,null,[{key:"create",value:function(t,n,r,o){if(this!==e&&!e.isPrototypeOf(this))throw Error("this.constructor must be prototype of Member");var i={};return i[o]=t,n.forEach(function(e){e!==o&&(i[e]=r[e])}),new this(i)}}]),e}();t.default=a},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.DEFAULT_TEMPLATE_FOREIGN_KEY="%s_id",t.DEFAULT_FACT_ID_PROP="id",t.DEFAULT_MEMBER_ID_PROP="id"},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=n(4),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),t}(u.default);t.default=c},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=n(0),a=n(5),u=function(e){return e&&e.__esModule?e:{default:e}}(a),c=function(e){var t=void 0===e?"undefined":o(e);return"object"!==t&&"function"!==t&&"undefined"!==t||null===e},s=function e(t){r(this,e);try{for(var n in t){if(!t.hasOwnProperty(n))return;c(t[n])?this[n]=t[n]:u.default.warn('[Fact] value of prop "'+n+'" has an unspecified value: '+t[n])}}catch(e){(0,i.handleError)(e)}};t.default=s},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=console,o={log:function(e){r.log("[Cube] "+e)},warn:function(e){r.warn("[Cube] "+e)},warnOnce:function(){var e={};return function(t){e[t]||(e[t]=!0,r.warn("[Cube] "+t))}}()};t.default=o},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=n(2),i=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.templateForeignKey,i=void 0===n?o.DEFAULT_TEMPLATE_FOREIGN_KEY:n;r(this,e),this.templateForeignKey=i};t.default=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=n(4),a=function(e){return e&&e.__esModule?e:{default:e}}(i),u=n(2),c=n(0),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.facts,o=void 0===n?[]:n,i=t.primaryKey,c=void 0===i?u.DEFAULT_FACT_ID_PROP:i,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};r(this,e),this.primaryKey=c,this.facts=o.map(function(t){return e.validateFactData(t,c),new a.default(t)}),this.defaultFactOptions=s}return o(e,[{key:"getFacts",value:function(){return this.facts}}],[{key:"validateFactData",value:function(e,t){if(!e[t])throw c.NotFoundFactId}},{key:"deleteProps",value:function(e,t,n){t.forEach(function(t){t!==n&&delete e[t]})}}]),e}();t.default=s},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(9),f=r(s),l=n(1),p=(r(l),n(10)),y=r(p),d=n(7),h=r(d),m=n(0),v=n(14),b=r(v),g=n(5),O=r(g),_=n(15),P=r(_),j=n(17),w=r(j),T=n(3),E=r(T),k=n(6),M=r(k),D=n(2),C=function e(t){var n=t.cells,r=t.primaryKey,o=t.defaultFactOptions,i=void 0===o?{}:o;a(this,e),this.cells=n.map(function(e){return f.default.isEmptyCell(e)?new f.default(e):new E.default(e)}),this.primaryKey=r,this.defaultFactOptions=i},x=function(){function e(t){a(this,e);var n=t.dimensionHierarchies,r=void 0===n?[]:n,o=t.cellTable,i=void 0===o?{}:o,c=t.settings,s=void 0===c?{}:c;Array.isArray(i)&&(i={cells:i},O.default.warnOnce('first argument "cells" as array type is deprecated now, use object for describe fact table'));var f=i,l=f.cells,p=void 0===l?[]:l,y=f.primaryKey,d=void 0===y?D.DEFAULT_FACT_ID_PROP:y,h=f.defaultFactOptions,m=void 0===h?{}:h;this.settings=new M.default(s),this.dimensionHierarchies=[],r.map(this._addDimensionHierarchy.bind(this)),this.cellTable=new C({cells:p,primaryKey:d,defaultFactOptions:u({},m)})}return c(e,[{key:"addFacts",value:function(e){var t=new h.default({facts:e,primaryKey:this.cellTable.primaryKey}),n=t.getFacts().map(function(e){return new E.default(e)});[].push.apply(this.getCells(),n);var r=this.getFacts();b.default.anotherBuild(r,n,this.dimensionHierarchies,this.getCells(),this.cellTable.primaryKey)}},{key:"removeFacts",value:function(e){var t=this.getCells(),n=this.cellTable.primaryKey,r=e.map(function(e){return t.find(function(t){return t[n]===e[n]})});this.removeCells(r)}},{key:"removeCells",value:function(e){b.default.destroy(this.getCells(),e,this.dimensionHierarchies,this)}},{key:"getFacts",value:function(){return this.denormalize(this.getCells())}},{key:"getDimensionMembers",value:function(e){return this.findDimensionTreeByDimension(e).getTreeValue().members}},{key:"getFactsBySet",value:function(e){return this.denormalize(this.getCellsBySet(e))}},{key:"getCells",value:function(){return this.cellTable.cells}},{key:"getCellsBySet",value:function(e){return this.projection(e).cellTable}},{key:"getDimensionMembersBySet",value:function(e,t){var n=this.projection(t),r=n.cellTable;return this.getDimensionMembersFromCells(e,r)}},{key:"projection",value:function(e){var t=this;if(e){var n=this.getCells();if(0===Object.keys(e).length)return{cellTable:n};var r={};Object.keys(e).forEach(function(t){r[t]=Array.isArray(e[t])?e[t]:[e[t]]});var a=this.dimensionHierarchies.length;if(Object.keys(e).length>a)throw"set must have length: "+a;var u=[],c=Object.keys(r).map(function(e){var n=r[e].map(function(n){var r=t.findDimensionTreeByDimension(e),o=r.createProjectionOntoMember(n),a=o.getRoot().getTreeValue(),c=a.dimension,s=a.members;return u.push(o),i({},c,s)});return w.default.union.apply(w.default,o(n))}),s=n,f=function(e,n){return!Object.keys(n).some(function(r){var o=n[r],i=t.findDimensionTreeByDimension(r).getTreeValue(),a=i.foreignKey,u=i.primaryKey;return!o.find(function(t){return t[u]===e[a]})})};return c.forEach(function(e){s=s.filter(function(t){return f(t,e)})}),{cellTable:s,dimensionHierarchies:u}}}},{key:"findDimensionTreeByDimension",value:function(e){var t=void 0;return this.dimensionHierarchies.forEach(function(n){n.getDimensionTreeByDimension(e)&&(t=n.getDimensionTreeByDimension(e))}),t}},{key:"getDimensionMembersFromCells",value:function(e,t){var n=this.findDimensionTreeByDimension(e),r=n.getRoot().getTreeValue(),o=r.members,i=(r.dimension,r.foreignKey),a=[];if(t.forEach(function(e){o.forEach(function(t){e[i]===r.getMemberId(t)&&-1===a.indexOf(t)&&a.push(t)})}),n.isRoot())return a;var u=a,c=!1,s=n;return n.getRoot().tracePreOrder(function(t,n){n.isRoot()||(c||(u=s.rollUpDimensionMembers(u),s=n),t.dimension===e&&(c=!0))}),u}},{key:"cartesian",value:function(){var e=function(e,t){var n;return(n=[]).concat.apply(n,o(e.map(function(e){return t.map(function(t){return[].concat(e,t)})})))},t=function t(n,r){for(var o=arguments.length,i=Array(o>2?o-2:0),a=2;a<o;a++)i[a-2]=arguments[a];return r?t.apply(void 0,[e(n,r)].concat(i)):n},n=[],r=this.dimensionHierarchies.map(function(e){return e.getTreeValue()}).map(function(e){return n.push(e.dimension),e.members}),i=new P.default,a=void 0;return r.length&&(a=r.length>1?t.apply(null,r):r[0].map(function(e){return[e]}),a.forEach(function(e){var t={};return n.forEach(function(n,r){t[n]=e[r]}),i.addTuple(t),t})),i}},{key:"denormalize",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getCells(),n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=b.default.denormalize(t,this.dimensionHierarchies);return n&&r.forEach(function(n,r){t[r]instanceof f.default&&delete n[e.cellTable.primaryKey]}),r}},{key:"residuals",value:function(){var e=this,t=this.cartesian(),n=[];return t.forEach(function(t){e.getFactsBySet(t).length>1&&n.push(t)}),n}},{key:"addDimensionMember",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments[4];if("string"!=typeof e)throw TypeError("parameter dimension expects as string: "+e);var c={};Object.keys(n).forEach(function(e){var t=n[e],o=r.getDimensionMembers(e),i=r.findDimensionTreeByDimension(e).getTreeValue(),a=i.primaryKey,u=t[a],s=o.find(function(e){return u===i.getMemberId(e)});if(!s)throw new m.CantAddMemberRollupException(e,u);c[e]=s});var s=this.findDimensionTreeByDimension(e),f=s.getChildTrees(),l=s.getTreeValue(),p=l.foreignKey,y={};f.forEach(function(e){var t=e.getTreeValue(),r=t.dimension,o=t.foreignKey,i=t.primaryKey,a=n[r];if(!a)throw new m.CantAddMemberRollupException(r);y[o]=a[i]});var d=u({},t,y),h=s.createMember(d),v=p;s.traceUpOrder(function(e){if(s!==e){var t=e.getTreeValue(),n=t.dimension,r=t.foreignKey,a=i({},v,l.getMemberId(h));u(a,o[n]),h=e.createMember(a),v=r}}),this.fill(a)}},{key:"removeDimensionMember",value:function(e,t){var n=this.findDimensionTreeByDimension(e),r=n.removeProjectionOntoMember(t),o=this.getCells(),i=function(e,t){var r=[],i=n.getDimensionTreeByDimension(e).getTreeValue(),a=i.foreignKey;return o.forEach(function(e){t.forEach(function(t){e[a]==i.getMemberId(t)&&r.push(e)})}),r};Object.keys(r).map(function(e){i(e,r[e]).forEach(function(e){var t=o.indexOf(e);-1!==t&&o.splice(t,1)})})}},{key:"fill",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=u({},this.cellTable.defaultFactOptions,e);if(!this.residuals().length){var n=this.createEmptyCells(t);this.addEmptyCells(n)}}},{key:"unfilled",value:function(){var e=this,t=this.cartesian(),n=[];return t.forEach(function(t){0===e.getFactsBySet(t).length&&n.push(t)}),n}},{key:"_addDimensionHierarchy",value:function(e){var t=y.default.createDimensionTree(e,this.settings);return this.dimensionHierarchies.push(t),t}},{key:"addDimensionHierarchy",value:function(e){var t=this._addDimensionHierarchy(e);b.default.anotherBuildOne(t,this.getCells(),this.getCells(),this.getCells(),this.cellTable.primaryKey)}},{key:"removeDimensionHierarchy",value:function(e){b.default.destroyDimensionTree(this.getCells(),this.getCells(),e,this),this.dimensionHierarchies.splice(this.dimensionHierarchies.indexOf(e),1)}},{key:"rollUp",value:function(e,t,n){var r=this.findDimensionTreeByDimension(e),o=n?this.findDimensionTreeByDimension(n):r.getChildTrees()[0];if(!n&&!o)return t;if(!r.hasChild(o))return t;var i=!1,a=r,u=t;return r.tracePreOrder(function(e,t){t!==r&&(i||(u=a.rollUpDimensionMembers(u),o===t?i=!0:a=t))}),u}},{key:"drillDown",value:function(e,t,n){var r=this.findDimensionTreeByDimension(e),o=n?this.findDimensionTreeByDimension(n):r.getParentTree();if(!n&&!o)return t;if(!r.hasParent(o))return t;var i=!1,a=r,u=t;return r.traceUpOrder(function(e){e!==r&&(i||(u=a.drillDownDimensionMembers(u),o===e?i=!0:a=e))}),u}},{key:"slice",value:function(e,t){return this._createProjectionOfCube(i({},e,t))}},{key:"dice",value:function(e){return this._createProjectionOfCube(e)}},{key:"_createProjectionOfCube",value:function(t){var n=this,r=this.projection(t),o=r.cellTable,i=r.dimensionHierarchies,a=[].concat(this.dimensionHierarchies);return i.forEach(function(e){var t=n.dimensionHierarchies.find(function(t){return t.getTreeValue().dimension===e.getTreeValue().dimension}),r=a.indexOf(t);a.splice(r,1,e)}),new e({cellTable:o,dimensionHierarchies:a})}},{key:"createEmptyCells",value:function(e){var t=this,n=[];return this.cartesian().forEach(function(r){if(!t.getCellsBySet(r).length){var o={};Object.keys(r).forEach(function(e){var n=t.findDimensionTreeByDimension(e).getTreeValue(),i=n.foreignKey;o[i]=n.getMemberId(r[e])});var i=u({},o,e),a=f.default.createEmptyCell(i);n.push(a)}}),n}},{key:"getEmptyCells",value:function(){return this.getCells().filter(function(e){return f.default.isEmptyCell(e)})}},{key:"addEmptyCells",value:function(t){e.validateInstance(t),[].push.apply(this.getCells(),t)}}],[{key:"create",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Array.isArray(t)&&(t={facts:t},O.default.warnOnce('first argument "facts" as array type is deprecated now, use object for describe fact table'));var o=t,i=o.facts,a=void 0===i?[]:i,c=o.primaryKey,s=o.defaultFactOptions,f=void 0===s?{}:s;if(!e.isPrototypeOf(this)&&e!==this)throw new m.CreateInstanceException;var l=new this({cellTable:{primaryKey:c,defaultFactOptions:f},dimensionHierarchies:n,settings:u({},r)});return l.addFacts(a),l}},{key:"validateInstance",value:function(e){e.forEach(function(e){if(!(e instanceof f.default))throw new TypeError("some item in list of argument is not instances of EmptyCell")})}}]),e}();t.default=x},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})}Object.defineProperty(t,"__esModule",{value:!0});var u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(3),s=function(e){return e&&e.__esModule?e:{default:e}}(c),f=function(e){function t(e,n){return r(this,t),e.id||(e.id=t.generateId()),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n))}return i(t,e),u(t,null,[{key:"createEmptyCell",value:function(e){return new t(e)}},{key:"isEmptyCell",value:function(e){return"string"==typeof e.id}},{key:"generateId",value:function(){return a()}}]),t}(s.default);t.default=f},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},c=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=n(11),f=r(s),l=n(6),p=r(l),y=n(13),d=r(y),h=(n(0),function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this)),r=e.dimensionTable,a=e.dependency,c=void 0===a?[]:a,s=e.parentNode,l=void 0===s?null:s;return Object.defineProperties(n,{dimensionTable:{value:new f.default(r),editable:!1,enumerable:!0},parentNode:{value:l,enumerable:!1,editable:!1},dependency:{value:c.map(function(e){return new t(u({},e,{parentNode:n}))}),enumerable:!0,editable:!1}}),n}return a(t,e),c(t,[{key:"getTreeValue",value:function(){return this.dimensionTable}},{key:"getParentTree",value:function(){return this.parentNode}},{key:"getChildTrees",value:function(){return this.dependency}},{key:"getDimensionTreeByDimension",value:function(e){return this.getRoot().searchTreeByTreeValue(function(t){return t.getTreeValue().dimension===e})}},{key:"createProjectionOntoMember",value:function(e){var n=this,r=new t(this.getRoot());r.tracePostOrder(function(e,t){t.getTreeValue().clearMemberList()});var o=void 0,i=void 0;return this.traceUpOrder(function(t){var a=t.getTreeValue(),u=a.dimension,c=t==n?[e]:i.drillDownDimensionMembers(o);r.getDimensionTreeByDimension(u).getTreeValue().setMemberList(c),o=c,i=t}),r}},{key:"removeProjectionOntoMember",value:function(e){var t=this.createProjectionOntoMember(e);this.subtractDimensionTree(t);var n={},r=t.getRoot().getTreeValue(),o=r.dimension,i=r.members;return n[o]=i,n}},{key:"subtractDimensionTree",value:function(e){var t=this,n={};e.tracePostOrder(function(e){var t=e.dimension,r=e.members;n[t]=r}),1===this.getTreeValue().members.length&&this.tracePreOrder(function(e){var t=e.getTreeValue(),r=t.members,o=t.dimension;n[o]=r}),Object.keys(n).forEach(function(e){var r=t.getDimensionTreeByDimension(e),o=r.getTreeValue();n[e].forEach(function(e){o.removeMember(e)})})}},{key:"drillDownDimensionMembers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isRoot())return e;var t=this.getParentTree(),n=t.getTreeValue(),r=n.members,o=n.primaryKey,i=this.getTreeValue(),a=i.foreignKey,u=[];return e.forEach(function(e){r.forEach(function(t){t[a]===e[o]&&-1===u.indexOf(t)&&u.push(t)})}),u}},{key:"rollUpDimensionMembers",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getTreeValue().members;if(this.isExternal())return e;var t=this.getChildTrees()[0],n=t.getTreeValue(),r=n.members,o=n.foreignKey,i=[];return e.forEach(function(e){r.forEach(function(t){e[o]===n.getMemberId(t)&&-1===i.indexOf(t)&&i.push(t)})}),i}},{key:"createMember",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.getTreeValue(),n=this.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),r=[];return n.forEach(function(e){r.push(e)}),t.createMember(e,r)}}],[{key:"createDimensionTree",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new p.default,r=n.templateForeignKey,o=function(e){e.foreignKey||(e.foreignKey=t.genericId(e.dimension,r))},i=new t(e);return i.tracePostOrder(o),i}},{key:"genericId",value:function(e,t){return t.replace("%s",e)}}]),t}(d.default));t.default=h},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=n(1),c=r(u),s=n(2),f=n(12),l=r(f),p=function(){function e(t){var n=this,r=t.dimension,a=t.foreignKey,u=t.primaryKey,f=void 0===u?s.DEFAULT_MEMBER_ID_PROP:u,l=t.keyProps,p=t.otherProps,y=void 0===p?[]:p,d=t.members,h=void 0===d?[]:d,m=t.defaultMemberOptions,v=void 0===m?{}:m;if(o(this,e),!r||!l)throw Error('Bad definition DimensionTable, params "dimension" and "keyProps" is required');if(-1!==Object.keys(v).indexOf(f))throw Error('Bad definition DimensionTable, "defaultMemberOptions" must not contain a "primaryKey" property');this.dimension=r,this.foreignKey=a,this.primaryKey=f,this.keyProps=[].concat(l),this.otherProps=[].concat(y),this.members=h.map(function(e){return new c.default(e,n.primaryKey)}),this.defaultMemberOptions=i({},v)}return a(e,[{key:"setMemberList",value:function(e){[].splice.apply(this.members,[0,this.members.length].concat(e))}},{key:"clearMemberList",value:function(){this.members=[]}},{key:"getMemberId",value:function(e){return e[this.primaryKey]}},{key:"addMember",value:function(e){-1===this.members.indexOf(e)?this.members.push(e):alert("boo")}},{key:"createMember",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments[1],r=i({},this.defaultMemberOptions,t),o=this.keyProps,a=this.otherProps,u=this.members,c=this.primaryKey,s=o.concat(n).concat(a),f=e.reduceId(u,c),p=l.default.create(f,s,r,c);return this.addMember(p),p}},{key:"setMemberId",value:function(e,t){e[this.primaryKey]=t}},{key:"deleteMemberId",value:function(e){delete e[this.primaryKey]}},{key:"removeMember",value:function(e){var t=this.members.indexOf(e);if(-1===t)throw new Error("represented member was not found",e);this.members.splice(t,1)}}],[{key:"reduceId",value:function(e,t){return e.length?e.reduce(function(e,n){return e[t]>n[t]?e:n},0)[t]+1:1}}]),e}();t.default=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),u=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},c=n(1),s=function(e){return e&&e.__esModule?e:{default:e}}(c),f=function(e){function t(){return r(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return i(t,e),a(t,null,[{key:"create",value:function(e,n,r,o){var i={};return n.forEach(function(e){i[e]=r.hasOwnProperty(e)?r[e]:null}),u(t.__proto__||Object.getPrototypeOf(t),"create",this).call(this,e,n,i,o)}}]),t}(s.default);t.default=f},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e)}return o(e,[{key:"getTreeValue",value:function(){throw"abstract method"}},{key:"getParentTree",value:function(){throw"abstract method"}},{key:"getChildTrees",value:function(){throw"abstract method"}},{key:"isExternal",value:function(){return!this.getChildTrees().length}},{key:"isFirstLevel",value:function(){return!this.isRoot()&&null===this.getParentTree().getParentTree()}},{key:"isRoot",value:function(){return null===this.getParentTree()}},{key:"getRoot",value:function(){var e=this;return this.traceUpOrder(function(t){t.isRoot()&&(e=t)}),e}},{key:"searchTreeByTreeValue",value:function(e){var t=void 0;return this.tracePostOrder(function(n,r){e(r)&&(t=r)}),t}},{key:"traceUpOrder",value:function(e){!function t(n){var r=n.getParentTree();e(n),null!==r&&t(r)}(this)}},{key:"tracePostOrder",value:function(e){!function t(n){var r=n.getChildTrees(),o=n.getTreeValue();r.length&&r.forEach(function(e){t(e)}),e(o,n)}(this)}},{key:"tracePreOrder",value:function(e){!function t(n){var r=n.getChildTrees(),o=n.getTreeValue();e(o,n),r.length&&r.forEach(function(e){t(e)})}(this)}},{key:"hasChild",value:function(e){var t=!1;return this.tracePreOrder(function(n,r){r===e&&(t=!0)}),t}},{key:"hasParent",value:function(e){var t=!1;return this.traceUpOrder(function(n){n===e&&(t=!0)}),t}}]),e}();t.default=i},function(e,t,n){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=n(7),s=r(c),f=n(1),l=r(f),p=function(){function e(){i(this,e)}return u(e,null,[{key:"anotherBuild",value:function(t,n,r,o,i){r.forEach(function(r){e.anotherBuildOne(r,n,o,t,i)})}},{key:"anotherBuildOne",value:function(t,n,r,o,i){t.tracePostOrder(function(t,a){e.processDimension(a,n,r,o,i)})}},{key:"processDimension",value:function(t,n,r,o,i){var a=t.isFirstLevel(),u=t.getTreeValue(),c=u.dimension,f=u.keyProps,l=void 0===f?[]:f,p=u.otherProps,y=void 0===p?[]:p,d=u.members,h=u.foreignKey,m=u.primaryKey,v=t.getChildTrees().map(function(e){return e.getTreeValue().foreignKey}),b=t.getChildTrees().map(function(e){return e.getTreeValue().dimension}),g=void 0,O=d.length,_=[i,m,h,O,o,n,c,l,y,n,a,r];if(v.length){var P=[],j=t.getDimensionTreeByDimension(b[0]).getTreeValue(),w=j.members;P=e.mapFilter(v[0],n,w,j),g=e.makeMemberListDependency.apply(null,_.concat([v,P]))}else g=e.makeMemberList.apply(null,_);n.forEach(function(e){s.default.deleteProps(e,l,i),s.default.deleteProps(e,y,i)}),g.forEach(function(e){u.addMember(e)})}},{key:"mapFilter",value:function(e,t,n,r){var o=[];return n.forEach(function(n){var i=t.filter(function(t){return t[e]==r.getMemberId(n)});o.push(i)}),o}},{key:"makeMemberListDependency",value:function(t,n,r,o,i,a,u,c,s,f,l,p,y,d){var h=[],m=0;return d.forEach(function(a){if(a.length){var d=e.makeMemberList(t,n,r,o,i,a,u,c,s,f,l,p,m);m+=d.length;var v=a[0];y.forEach(function(e){d.forEach(function(t){t[e]=v[e],t[n]=o+h.length+1,h.push(t)}),a.forEach(function(t){delete t[e]})})}}),h}},{key:"makeMemberList",value:function(t,n,r,o,i,a,u){var c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],s=arguments.length>8&&void 0!==arguments[8]?arguments[8]:[],f=arguments[9],p=(arguments[10],arguments[11]),y=arguments.length>12&&void 0!==arguments[12]?arguments[12]:0,d={},h={},m=[];return p.filter(function(e){return-1===f.indexOf(e)}).forEach(function(n){var r=i.find(function(e){return e[t]===n[t]}),o=e.createKeyFromProps(c,r);o in h||(h[o]=++y)}),a.forEach(function(t){var n=e.createKeyFromProps(c,t);n in d||n in h||(d[n]=++y);var o=d[n];t[r]=o}),Object.keys(d).forEach(function(e){var t=d[e],o=a.find(function(e){return e[r]===t}),i=l.default.create(t,[].concat(c).concat(s),o,n);m.push(i)}),m}},{key:"createKeyFromProps",value:function(e,t){return e.map(function(e){return t[e]}).join(",")}},{key:"destroy",value:function(t,n,r,o){var i=this;n.forEach(function(e){var n=t.indexOf(e);-1!==n&&t.splice(n,1)}),n.forEach(function(t){r.forEach(function(n){e.travers([t],n,[e.removeMembers.bind(i,o,n),e.restoreCell])})})}},{key:"denormalize",value:function(t,n){var r=new s.default,o=r.getFacts();return t.forEach(function(e){o.push(a({},e))}),o.forEach(function(t){n.forEach(function(n){e.travers([t],n,[e.restoreCell])})}),o}},{key:"restoreCell",value:function(e,t,n,r,o,i){var u=new l.default(e);i.deleteMemberId(u),delete r[o],a(r,u)}},{key:"removeMembers",value:function(e,t,n,r,i,a,u){var c=e.projection(o({},i,n)),s=c.cellTable,f=t.getDimensionTreeByDimension(i).getTreeValue();s.length||f.removeMember(n)}},{key:"travers",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},r=function(e,t){var r=e.getTreeValue(),o=r.dimension,i=r.members,a=r.foreignKey,u=t[a],c=i.find(function(e){return r.getMemberId(e)===u});n.forEach(function(e){e(c,i,o,t,a,r)})};e.forEach(function(e){t.tracePreOrder(function(t,n){r(n,e)})})}},{key:"destroyDimensionTree",value:function(t,n,r,o){e.travers(t,r,[e.removeMembers.bind(this,o,r),e.restoreCell])}}]),e}();t.default=p},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},u=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),c=function e(t,n,r){null===t&&(t=Function.prototype);var o=Object.getOwnPropertyDescriptor(t,n);if(void 0===o){var i=Object.getPrototypeOf(t);return null===i?void 0:e(i,n,r)}if("value"in o)return o.value;var a=o.get;if(void 0!==a)return a.call(r)},s=n(16),f=function(e){return e&&e.__esModule?e:{default:e}}(s),l=function(e){function t(e){r(this,t);var n=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return Array.isArray(e)&&a(n,e.map(function(e){return new f.default(e)})),n}return i(t,e),u(t,[{key:"addTuple",value:function(e){this.push(new f.default(e))}},{key:"forEach",value:function(){return c(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"forEach",this).apply(this,arguments)}}]),t}(function(e){function t(){var t=Reflect.construct(e,Array.from(arguments));return Object.setPrototypeOf(t,Object.getPrototypeOf(this)),t}return t.prototype=Object.create(e.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e,t}(Array));t.default=l},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},i=function e(t){r(this,e),o(this,t)};t.default=i},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),i=function(){function e(){r(this,e)}return o(e,null,[{key:"union",value:function(){var t={};return[].concat(Array.prototype.slice.call(arguments)).forEach(function(n){e.add(t,n)}),t}},{key:"add",value:function(e,t){Object.keys(t).forEach(function(n){e[n]||(e[n]=[]),Array.prototype.push.apply(e[n],t[n])})}}]),e}();t.default=i}]).default});